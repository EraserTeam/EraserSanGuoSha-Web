var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},DrogComponent=function(e){function t(){var t=e.call(this)||this;return t.enableDrog=!0,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddedToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemovedFromStage,t),t}return __extends(t,e),t.prototype.onAddedToStage=function(){this.touchEnabled=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this)},t.prototype.startMove=function(e){this.enableDrog&&(this.offsetX=e.stageX-this.x,this.offsetY=e.stageY-this.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this))},t.prototype.stopMove=function(e){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},t.prototype.onMove=function(e){this.x=e.stageX-this.offsetX,this.y=e.stageY-this.offsetY},t.prototype.onRemovedFromStage=function(){this.touchEnabled=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)},t}(eui.Component);__reflect(DrogComponent.prototype,"DrogComponent");var AskingType;!function(e){e[e.None=0]="None",e[e.Discard=1]="Discard",e[e.PlayCard=2]="PlayCard",e[e.RespondCard=3]="RespondCard",e[e.UseCard=4]="UseCard",e[e.SelectCardInWindow=5]="SelectCardInWindow",e[e.SelectGlobalCardInWindow=6]="SelectGlobalCardInWindow",e[e.UseSkill=7]="UseSkill",e[e.SelectSuit=8]="SelectSuit"}(AskingType||(AskingType={}));var Player=function(){function e(){this.hand=[],this.judgeZone=[],this.equipZone=[void 0,void 0,void 0,void 0],this.seatID=-1,this._seatNum=-1,this._maxHP=0,this._HP=0,this._alive=!0,this._selected=!1,this._cannotSelect=!1,this._dark=!1,this.skills=[],this.flag={},this._general=void 0,this._name=void 0,this._country=void 0,this._sex=void 0,this._identity=void 0,this._back=!1}return Object.defineProperty(e.prototype,"self",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.handCardsChange=function(){this.bigArea.cardCountLabel.lb_cardCount.text=this.hand.length.toString()},e.prototype.addHandCards=function(e){(t=this.hand).push.apply(t,e),this.handCardsChange();var t},e.prototype.removeHandCards=function(e){this.self?this.hand=this.hand.filter(function(t){return!e.includes(t)}):this.hand.splice(0,e.length),this.handCardsChange()},e.prototype.addToJudgeZone=function(e){var t=this;(n=this.judgeZone).push.apply(n,e),e.forEach(function(e){t.bigArea.addToJudgeZoneUI(e["class"].name)});var n},e.prototype.removeFromJudgeZone=function(e){var t=this;e.forEach(function(e){var n=t.judgeZone.findIndex(function(t){return t["class"].name==e["class"].name});~n&&t.judgeZone.splice(n,1),t.bigArea.removeFromJudgeZoneUI(e["class"].name)})},e.prototype.setEquip=function(e,t){this.equipZone[e]=t;var n=this.bigArea.equipUI,r=n[e];t?(r.equip=t,r.visible=!0,egret.Tween.removeTweens(r),this.self?(r.x=-r.width,egret.Tween.get(r).to({x:7},300)):(r.y=r.y-4,egret.Tween.get(r).to({y:84+10*e},300))):r.visible=!1},e.prototype.hasEquipType=function(e){return"undefined"!=typeof this.equipZone[e]},e.prototype.hasEquip=function(e){return this.equipZone.some(function(t){return!(!t||t["class"].name!=e)})},e.prototype.hasCardClassInJudgeZone=function(e){return this.judgeZone.some(function(t){return t["class"].name==e})},Object.defineProperty(e.prototype,"room",{get:function(){return Game.room},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"generalArea",{get:function(){return UI.generalArea(this.seatID)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HPArea",{get:function(){return this.generalArea.HPArea},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bigArea",{get:function(){return UI.bigArea(this.seatID)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seatNum",{get:function(){return this._seatNum},set:function(e){this._seatNum=e,this.generalArea.seatNum=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxHP",{get:function(){return this._maxHP},set:function(e){this._maxHP=e,this.HPArea.maxHP=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HP",{get:function(){return this._HP},set:function(e){this._HP=e,this.HPArea.HP=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alive",{get:function(){return this._alive},set:function(e){this._alive=e,this.bigArea.alive=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"general",{get:function(){return this._general},set:function(e){this._general=e,this.generalArea.general=e,this.name=e.tipName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e,this.generalArea.name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"country",{get:function(){return this._country},set:function(e){this._country=e,this.bigArea.country=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sex",{get:function(){return this._sex},set:function(e){this._sex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"identity",{get:function(){return this._identity},set:function(e){this._identity=e,this.bigArea.identity=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"back",{get:function(){return this._back},set:function(e){this._back=e,this.generalArea.back=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"front",{get:function(){return!this.back},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wounded",{get:function(){return this.HP<this.maxHP},enumerable:!0,configurable:!0}),e.prototype.getFlag=function(e){return this.flag[e]},e.prototype.setFlag=function(e,t){this.flag[e]=t},Object.defineProperty(e.prototype,"equipZoneCards",{get:function(){return this.equipZone.filter(function(e){return e})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,this.generalArea.img_selected.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cannotSelect",{get:function(){return this._cannotSelect},set:function(e){this._cannotSelect=e,e?this.generalArea.componentToSelect.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelected,this):this.generalArea.componentToSelect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelected,this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dark",{get:function(){return this._dark},set:function(e){this._dark=e,this.generalArea.img_dark.visible=e},enumerable:!0,configurable:!0}),e.prototype.onSelected=function(){if(this.selected=!this.selected,this.selected)this.room.selectedPlayers.push(this);else{var e=this.room.selectedPlayers.indexOf(this);~e&&this.room.selectedPlayers.splice(e,1)}UI.self.operationArea.refreshButtonStatus(),UI.sceneGame.refreshPlayerSelect()},e.prototype.refreshPhase=function(){var e="";this.room.round.phase;this.room.round.player==this&&(this.room.round.phase==Phase.Prepare?e="RoundBegin_png":this.room.round.phase==Phase.Judge?e="JudgePhase_png":this.room.round.phase==Phase.Draw?e="DrawPhase_png":this.room.round.phase==Phase.Play?e="PlayPhase_png":this.room.round.phase==Phase.Discard?e="DiscardPhase_png":this.room.round.phase==Phase.Over?e="OverPhase_png":this.room.round.began&&(e="RoundBegin_png"),this.self&&""!=e&&(e="Self"+e));var t=this.bigArea.img_phase;t&&t.source!=e&&(t.source=e,this.self?(t.x=0,egret.Tween.get(t).to({x:50},350)):(t.horizontalCenter=-35,egret.Tween.get(t).to({horizontalCenter:0},350)))},e.prototype.getSkill=function(e){"string"==typeof e&&(e=new Skill(e)),this.hasSkill(e.name)||this.skills.push(e)},e.prototype.hasSkill=function(e){var t=this.skills.some(function(t){return t.name==e});return t?!0:this.room.syncEvents.emit(GameSyncEvent.HasSkill,this,e)},Object.defineProperty(e.prototype,"hasCard",{get:function(){return this.hand.length>0||this.equipZoneCards.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZoneCard",{get:function(){return this.hand.length>0||this.equipZoneCards.length>0||this.judgeZone.length>0},enumerable:!0,configurable:!0}),e.prototype.distanceTo=function(e){var t,n=this;return e==this?t=0:(t=this.calcDistanceBySeatNum(e),this.room.syncEvents.callbackEmit(GameSyncEvent.CalcDistance,function(r){var a=r(n,e,t);"undefined"!=typeof a&&(t=a,1>t&&(t=1))})),t},e.prototype.calcDistanceBySeatNum=function(e){var t=Game.sortPlayersBySeatNum(this.room.alivePlayers,this),n=[t.indexOf(this),t.indexOf(e)],r=n[0],a=n[1];if(-1==r)throw new Error("Cannot find fromPlayer.Maybe he was dead.");if(-1==a)throw new Error("Cannot find toIndex.Maybe he was dead.");var i=a-r,o=t.length-i;return i>o?o:i},Object.defineProperty(e.prototype,"attackRange",{get:function(){var e=this.equipZone[EquipType.Arm];if(e){var t=e["class"].attackRange;return"undefined"==typeof t&&(t=1),t}return 1},enumerable:!0,configurable:!0}),e.prototype.inAttackRange=function(e){return e==this?!1:e.attackRange>=e.distanceTo(this)},e.prototype.limitUseCount=function(e){var t=this,n=!0;return this.room.syncEvents.callbackEmit(GameSyncEvent.LimitUseCount,function(r){var a=r(t,e);"undefined"!=typeof a&&(n=a)}),n},e.prototype.limitDistance=function(e){var t=this,n=!0;return this.room.syncEvents.callbackEmit(GameSyncEvent.LimitDistance,function(r){var a=r(t,e);"undefined"!=typeof a&&(n=a)}),n},e.prototype.extraMaxTargetCount=function(e){var t=this,n=0;return this.room.syncEvents.callbackEmit(GameSyncEvent.CalcExtraMaxTargetCount,function(r){var a=r(t,e,n);"undefined"!=typeof a&&(n=a)}),n},e.prototype.cardFilterSelect=function(e,t,n){if(!e["class"].filterSelect)return[];var r=n.filter(function(t){return!(e["class"].type==CardType.Bag&&e["class"].delay&&t.hasCardClassInJudgeZone(e["class"].name))});return e["class"].filterSelect(e,this,t,r)},e.prototype.cardSelectCorrectly=function(e,t){for(var n=0,r=t;n<r.length;n++){var a=r[n];if(!a.alive)return!1;if(e["class"].type==CardType.Bag&&e["class"].delay&&a.hasCardClassInJudgeZone(e["class"].name))return!1}for(var i=this.room.alivePlayers,o=function(n){var r=t.slice(0,n),a=i.filter(function(e){return!r.includes(e)});return s.cardFilterSelect(e,r,a).includes(t[n])?void 0:{value:!1}},s=this,l=0;l<t.length-1;l++){var u=o(l);if("object"==typeof u)return u.value}return e["class"].selectCorrectly(e,this,t)},e.prototype.cardEnabled=function(e){return e["class"].enabled(e,this)},e}();__reflect(Player.prototype,"Player");var GameWindow=function(e){function t(t){var n=e.call(this)||this;return n.addEventListener(egret.Event.COMPLETE,function(){t&&(n.title=t)},n),n.skinName="GameWindowSkin",n}return __extends(t,e),Object.defineProperty(t.prototype,"title",{get:function(){return this.lb_title.text},set:function(e){this.lb_title.textFlow=(new egret.HtmlTextParser).parser(e)},enumerable:!0,configurable:!0}),t.prototype.show=function(){var e=UI.others.gameArea;this.x=e.x+(e.width-this.width)/2,this.y=e.y+(e.height-this.height)/2,UI.sceneGame.group_top.addChild(this)},t.prototype.exit=function(){UI.sceneGame.group_top.removeChild(this)},t}(DrogComponent);__reflect(GameWindow.prototype,"GameWindow");var SkillType;!function(e){e[e.Normal=1]="Normal",e[e.Lock=2]="Lock",e[e.Limit=3]="Limit",e[e.Awake=4]="Awake"}(SkillType||(SkillType={}));var Card=function(){function e(e,t){this.seatID=-1,this.realCards=[],this.room=e,this.data=t,this._class=Game.getCardClass(t)}return Object.defineProperty(e.prototype,"cardID",{get:function(){return this.data.cardID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"class",{get:function(){return this._class},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"number",{get:function(){if(this.virtual){var e=this.realCards.map(function(e){return e.number}).reduce(function(e,t){return e+t},0);return e>13&&(e=13),e}return+this.data.number},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suit",{get:function(){return this.virtual?1==this.realCards.length?this.realCards[0].suit:Suit.None:this.data.suit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.virtual?1==this.realCards.length?Game.getColor(this.realCards[0].suit):this.realCards.every(function(e){return e.color==Color.Red})&&Color.Red||this.realCards.every(function(e){return e.color==Color.Black})&&Color.Black||Color.None:Game.getColor(this.suit)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inHand",{get:function(){return this.zone==Zone.Hand},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inEquip",{get:function(){return this.zone==Zone.Equip},enumerable:!0,configurable:!0}),e}();__reflect(Card.prototype,"Card");var CardType;!function(e){e[e.Basic=1]="Basic",e[e.Bag=2]="Bag",e[e.Equip=3]="Equip"}(CardType||(CardType={}));var Color;!function(e){e[e.None=0]="None",e[e.Red=1]="Red",e[e.Black=2]="Black"}(Color||(Color={}));var Country;!function(e){e[e.None=0]="None",e[e.Wei=1]="Wei",e[e.Shu=2]="Shu",e[e.Wu=3]="Wu",e[e.Qun=4]="Qun"}(Country||(Country={}));var EquipType;!function(e){e[e.Arm=0]="Arm",e[e.Armor=1]="Armor",e[e.PlusHorse=2]="PlusHorse",e[e.MinusHorse=3]="MinusHorse"}(EquipType||(EquipType={}));var Game=function(){function e(){}return e.init=function(){Predefined.init(),Package.init(),e.initJSON(),e.initSocket(),e.room=new Room,e.room.init()},e.initJSON=function(){this.cards=RES.getRes("Cards_json")},e.initSocket=function(){this.socket=io.connect("127.0.0.1:43666")},e.getCardByID=function(t){if(0==t)return e.unknownCard;var n=e.cards.find(function(e){return e.cardID==t});return n=n||e.unknownCard},e.getCardsByID=function(t){return t.map(function(t){return e.getCardByID(t)})},e.getCardIDs=function(e){return e.map(function(e){return e.cardID})},e.makeCardUIData=function(t){var n=e.getSuitName(t.suit).toLowerCase(),r=e.getColorName(e.getColor(t.suit));return{cardID:t.cardID,number:r&&t.number?r+"CardNumber_"+t.number:"","class":"Card_"+(t["class"]?t["class"].name:"Unknown")+"_png",suit:"none"!=n?n:"",dark:!1,disabled:!0}},e.getPackage=function(t){return e.packages[t]},e.createPackage=function(t){if(e.packages[t])throw new Error('Package "'+t+'" already exists');return e.packages[t]=new Package(t)},e.getCardClass=function(t){return e.cardClasses[t["class"]]},e.getSkill=function(t){return e.skills[t]},e.getGeneral=function(t){return e.generals[t]},e.getAskingTypeContents=function(t){return e.askingTypeContents[t]},e.getAsking=function(t){return e.askings[t]},e.getMode=function(t){return e.modes[t]},e.createMode=function(t){if(e.modes[t.name])throw new Error('Mode "'+t.name+'" already exists.');e.modes[t.name]=t},e.getCountryName=function(e){return Country[e]},e.getSuitName=function(e){return Suit[e]},e.getColor=function(e){return e==Suit.Heart||e==Suit.Diamond?Color.Red:e==Suit.Spade||e==Suit.Club?Color.Black:Color.None},e.getColorName=function(e){return Color[e]},e.getSexName=function(e){return Sex[e]},e.getIdentityName=function(e){return Identity[e]},e.sortPlayersBySeatNum=function(e,t){var n=t?t.seatNum:0;return e.slice().sort(function(e,t){return e.seatNum>=n&&t.seatNum<n?-1:e.seatNum<n&&t.seatNum>=n?1:e.seatNum-t.seatNum})},e.unknownCard={cardID:0,"class":"",number:0,suit:0},e.packages={},e.cardClasses={},e.skills={},e.generals={},e.askingTypeContents={},e.askings={},e.modes={},e}();__reflect(Game.prototype,"Game");var GameSyncEvent;!function(e){e[e.HasSkill=0]="HasSkill",e[e.CalcDistance=1]="CalcDistance",e[e.LimitUseCount=2]="LimitUseCount",e[e.LimitDistance=3]="LimitDistance",e[e.CalcExtraMaxTargetCount=4]="CalcExtraMaxTargetCount",e[e.IgnoreArmor=5]="IgnoreArmor",e[e.ArmorInvalid=6]="ArmorInvalid",e[e.CanAnswerCard=7]="CanAnswerCard",e[e.CalcRecoverNumber=8]="CalcRecoverNumber"}(GameSyncEvent||(GameSyncEvent={}));var SyncGameEventCanStop=function(e,t){switch(e){case GameSyncEvent.HasSkill:case GameSyncEvent.IgnoreArmor:return!!t;case GameSyncEvent.LimitUseCount:case GameSyncEvent.LimitDistance:case GameSyncEvent.ArmorInvalid:case GameSyncEvent.CanAnswerCard:return!t;default:return!1}},EventEmitter=function(){function e(){this._listeners={}}return e.prototype.on=function(e,t,n){void 0===n&&(n=0),this._listeners[e]=this._listeners[e]||[];for(var r=this._listeners[e].length,a=0,i=this._listeners[e].entries();a<i.length;a++){var o=i[a],s=o[0],l=o[1];if(n>l.pri){r=s;break}}return this._listeners[e].splice(r,0,{listener:t,pri:n}),this},e.prototype.listeners=function(e){return this._listeners[e]||[]},e.prototype.removeListener=function(e,t){for(var n=0,r=Object.keys(this._listeners).map(function(e){return+e});n<r.length;n++){var a=r[n];if(a==e){this._listeners[e]=this._listeners[e].filter(function(e){return e.listener!=t});break}}},e}();__reflect(EventEmitter.prototype,"EventEmitter");var GameSyncEventEmitter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r,a=this.listeners(e),i=0,o=a;i<o.length;i++){var s=o[i],l=s.listener;if(r=l.apply(void 0,t),SyncGameEventCanStop(e,r))return r}return r},t.prototype.callbackEmit=function(e,t){this.listeners(e).forEach(function(e){t(e.listener)})},t.prototype.on=function(t,n,r){return void 0===r&&(r=0),e.prototype.on.call(this,t,n,r)},t}(EventEmitter);__reflect(GameSyncEventEmitter.prototype,"GameSyncEventEmitter");var Identity;!function(e){e[e.Unknown=0]="Unknown",e[e.ZhuGong=1]="ZhuGong",e[e.ZhongChen=2]="ZhongChen",e[e.FanZei=3]="FanZei",e[e.NeiJian=4]="NeiJian"}(Identity||(Identity={}));var Package=function(){function e(e){this.cardClasses={},this.skills={},this.generals={},this.askingTypeContents={},this.askings={},this.name=e}return e.init=function(){for(var t=0,n=Object.keys(e.card);t<n.length;t++){var r=n[t];e.card[r]()}for(var a=0,i=Object.keys(e.general);a<i.length;a++){var r=i[a];e.general[r]()}for(var o=0,s=Object.keys(e.modes);o<s.length;o++){var r=s[o];e.modes[r]()}},e.prototype.getCardClass=function(e){return this.cardClasses[e["class"]]||{"package":this,type:0,enabled:!1}},e.prototype.createCardClass=function(e){var t=this.initCardClass(e);Game.cardClasses[t.name]=this.cardClasses[t.name]=t},e.prototype.initCardClass=function(t){if(Game.cardClasses[t.name])throw new Error('CardClass "'+t.name+'" already exists.');if(t.type==CardType.Equip){if("undefined"==typeof t.equipType)throw new Error("missing equipType");if(t.equipType==EquipType.Arm&&"undefined"==typeof t.attackRange)throw new Error("missing attackRange")}if(t.enabled===!1?t.enabled=e.cardClassEnabledFalse:t.enabled===!0&&(t.enabled=e.cardClassEnabledTrue),"function"!=typeof t.tip){var n=t.tip||"";t.tip=function(){return n}}t.filterSelect?t.filterSelect===!0&&(t.filterSelect=e.cardClassFilterSelectTrue):t.filterSelect=!1,t.selectCorrectly||(t.selectCorrectly=e.cardClassSelectCorrectlyDefault),t.showTargetLines||(t.showTargetLines=e.cardClassShowTatgetLinesDefault);var r=t;return r["package"]=this,r.fullName=r.name,r.tipFullName=r.tipName,r},e.prototype.createCardSubclass=function(e){var t=this.initCardSubclass(e);Game.cardClasses[t.name]=this.cardClasses[t.name]=t},e.prototype.initCardSubclass=function(e){if(Game.cardClasses[e.fullName])throw new Error('CardClass "'+e.fullName+'" already exists.');var t=Game.cardClasses[e.name];return{"package":this,name:e.name,fullName:e.fullName,tipName:t.tipName,tipFullName:e.tipFullName,type:t.type,delay:t.delay,equipType:t.equipType,attackRange:t.attackRange,enabled:t.enabled,tip:t.tip,filterSelect:t.filterSelect,selectCorrectly:t.selectCorrectly,showTargetLines:t.showTargetLines,init:t.init}},e.prototype.getSkill=function(e){return this.skills[e]},e.prototype.createSkill=function(e){var t=this.initSkill(e);Game.skills[t.name]=this.skills[t.name]=t},e.prototype.initSkill=function(t){if(Game.skills[t.name])throw new Error('Skill "'+t.name+'" already exists.');if(t.enabled||(t.enabled=e.skillEnabledDefault),"function"!=typeof t.tip){var n=t.tip||"";t.tip=function(){return n}}"undefined"==typeof t.maxCardCount&&(t.maxCardCount=0),"undefined"==typeof t.minCardCount&&(t.minCardCount=t.maxCardCount?1:0),t.filterCard?t.filterCard===!0&&(t.filterCard=e.skillFilterCardTrue):t.filterCard=e.skillFilterCardDefault,t.filterSelect?t.filterSelect===!0&&(t.filterSelect=e.skillFilterSelectTrue):t.filterSelect=!1,t.selectCorrectly||(t.selectCorrectly=e.skillSelectCorrectlyTrue),"undefined"==typeof t.cancel&&(t.cancel=!0),t.showTargetLines||(t.showTargetLines=e.skillShowTatgetLinesDefault);var r=t;return r["package"]=this,r},e.prototype.getGeneral=function(e){return this.generals[e]},e.prototype.createGeneral=function(e){if(Game.generals[e.name])throw new Error('General "'+e.name+'" already exists.');var t=e;t["package"]=this,Game.generals[t.name]=this.generals[t.name]=t},e.prototype.createAskingTypeContent=function(e){var t=e.askingType,n=this.initAskingTypeContent(e);n["package"]=this,Game.askingTypeContents[t]=this.askingTypeContents[t]=n},e.prototype.initAskingTypeContent=function(t){if(Game.askingTypeContents[t.askingType])throw new Error('AskingTypeContents "'+AskingType[t.askingType]+'" already exists.');if("function"!=typeof t.tip){var n=t.tip||"";t.tip=function(){return n}}if("undefined"==typeof t.maxCardCount&&(t.maxCardCount=0),"number"==typeof t.maxCardCount){var r=t.maxCardCount;t.maxCardCount=function(){return r}}if("undefined"==typeof t.minCardCount)t.minCardCount=function(e){return t.maxCardCount(e)?1:0};else if("number"==typeof t.minCardCount){var a=t.minCardCount;t.minCardCount=function(){return a}}t.filterCard||(t.filterCard=e.askingTypeContentFilterCardDefault),t.filterSelect||(t.filterSelect=e.askingTypeContentFilterSelectDefault),t.selectCorrectly||(t.selectCorrectly=e.askingTypeContentSelectCorrectlyDefault),["heart","diamond","spade","club"].forEach(function(e){t.btnStatus[e]=t.btnStatus[e]||{visible:function(){return!1}}});var i=t;return i["package"]=this,delete i.askingType,i},e.prototype.getAsking=function(e){return this.askings[e]},e.prototype.createAsking=function(e){if(Game.askings[e.name])throw new Error('Asking "'+e.name+'" already exists.');var t=e;t["package"]=this,Game.askings[t.name]=this.askings[t.name]=t},e.card={},e.general={},e.modes={},e.cardClassEnabledFalse=function(){return!1},e.cardClassEnabledTrue=function(){return!0},e.cardClassFilterSelectTrue=function(e,t,n,r){return r},e.cardClassSelectCorrectlyDefault=function(){return!0},e.cardClassFilterTargetDefault=function(e,t,n){return n},e.cardClassShowTatgetLinesDefault=function(e,t,n){return t.forEach(function(t){return n(e,t)})},e.skillEnabledDefault=function(){return!1},e.skillFilterCardDefault=function(){return[]},e.skillFilterCardTrue=function(e,t,n,r){return r},e.skillFilterSelectTrue=function(e,t,n,r,a){return a},e.skillSelectCorrectlyTrue=function(){return!0},e.skillShowTatgetLinesDefault=function(e,t,n){return t.forEach(function(t){return n(e,t)})},e.askingTypeContentFilterCardDefault=function(){return[]},e.askingTypeContentFilterSelectDefault=function(){return!1},e.askingTypeContentSelectCorrectlyDefault=function(){return!0},e.askingTypeContentViewAsDefault=function(){},e}();__reflect(Package.prototype,"Package");var Phase;!function(e){e[e.Prepare=1]="Prepare",e[e.Judge=2]="Judge",e[e.Draw=3]="Draw",e[e.Play=4]="Play",e[e.Discard=5]="Discard",e[e.Over=6]="Over"}(Phase||(Phase={}));var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){this.addChild(UI.sceneGame)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var Predefined=function(){function e(){}return e.init=function(){e.pkg=Game.createPackage("predefined"),e.initAskingTypeContents(),e.pkg.createSkill({name:"$PlusHorse",type:SkillType.Lock,init:function(e){e.syncEvents.on(GameSyncEvent.CalcDistance,function(e,t,n){return t.hasSkill("$PlusHorse")?n+1:void 0})}}),e.pkg.createSkill({name:"$MinusHorse",type:SkillType.Lock,init:function(e){e.syncEvents.on(GameSyncEvent.CalcDistance,function(e,t,n){return e.hasSkill("$MinusHorse")?n-1:void 0})}})},e.createPlusHorse=function(t,n){e.createHorse(!0,t,n)},e.createMinusHorse=function(t,n){e.createHorse(!1,t,n)},e.createHorse=function(e,t,n){Object.keys(n).forEach(function(r){var a=n[r];t.createCardClass({name:r,tipName:a,type:CardType.Equip,equipType:e?EquipType.PlusHorse:EquipType.MinusHorse,enabled:!0,tip:"装备"+a+"后，"+(e?"你防守时其他角色与你的距离会+1":"你进攻时与其他角色的距离会-1"),init:function(t){t.syncEvents.on(GameSyncEvent.HasSkill,function(t,n){return n==(e?"$PlusHorse":"$MinusHorse")?t.hasEquip(r):void 0})}})})},e.initAskingTypeContents=function(){e.pkg.createAskingTypeContent({askingType:AskingType.Discard,tip:function(){return"您需要弃置 "+Game.room.askingParam.maxCount+"张卡牌"},minCardCount:function(e){return e.room.askingParam.minCount},maxCardCount:function(e){return e.room.askingParam.maxCount},filterCard:function(e,t,n){return n.filter(function(e){return e.inHand})},btnStatus:{ok:{visible:function(){return!0},enabled:function(){return UI.self.gameArea.selectCorrectly},onClick:function(){return Game.room.selfPlayer.answer(UI.self.gameArea.selectedCardIDs)}},cancel:{visible:function(){return!0},enabled:function(){return UI.self.gameArea.selectedCount>0},onClick:function(){return UI.self.gameArea.cancelSelection()}},over:{visible:function(){return!1}}}}),e.pkg.createAskingTypeContent({askingType:AskingType.PlayCard,tip:function(){if(0==UI.self.gameArea.selectedCount)return"出牌阶段，请选择一张卡牌";var e=UI.self.gameArea.selectedCards[0];return e["class"].tip(e)},maxCardCount:1,filterCard:function(e,t,n){return n.filter(function(t){return t.inHand&&e.cardEnabled(t)})},filterSelect:function(e,t,n,r){if(e.length<t.room.askingParam.minCardCount(t))return!1;var a=e[0];return a["class"].filterSelect?t.cardFilterSelect(a,n,r):!1},selectCorrectly:function(e,t,n){var r=e[0];return 1==e.length?t.cardSelectCorrectly(r,n):!1},btnStatus:{ok:{visible:function(){return!0},enabled:function(){return UI.self.gameArea.selectCorrectly},onClick:function(){return Game.room.selfPlayer.answer({cardID:UI.self.gameArea.selectedCardIDs[0],selected:Game.room.selectedPlayers.map(function(e){return e.seatID})})}},cancel:{visible:function(){return!0},enabled:function(){return UI.self.gameArea.selectedCount>0},onClick:function(){return UI.self.gameArea.cancelSelection()}},over:{visible:function(){return!0},enabled:function(){return!0},onClick:function(){return Game.room.selfPlayer.answerNo()}}}}),e.pkg.createAskingTypeContent({askingType:AskingType.RespondCard,maxCardCount:1,filterCard:function(e,t,n){return n.filter(function(t){return t.inHand&&e.room.askingParam.cardClassName==t["class"].name})},btnStatus:{ok:{visible:function(){return!0},enabled:function(){return UI.self.gameArea.selectCorrectly},onClick:function(){return Game.room.selfPlayer.answer({cardID:UI.self.gameArea.selectedCardIDs[0]})}},cancel:{visible:function(){return!0},enabled:function(){return!0},onClick:function(){return Game.room.selfPlayer.answerNo()}},over:{visible:function(){return!1}}}}),e.pkg.createAskingTypeContent({askingType:AskingType.UseCard,tip:function(){return Game.room.askingParam.tip},maxCardCount:1,filterCard:function(e,t,n){return n.filter(function(t){return t.inHand&&e.room.askingParam.cardClassName==t["class"].name})},btnStatus:{ok:{visible:function(){return!0},enabled:function(){return UI.self.gameArea.selectCorrectly},onClick:function(){return Game.room.selfPlayer.answer({cardID:UI.self.gameArea.selectedCardIDs[0]})}},cancel:{visible:function(){return!0},enabled:function(){return!0},onClick:function(){return Game.room.selfPlayer.answerNo()}},over:{visible:function(){return!1}}}});var t=function(e){var t=Game.getSkill(e.room.askingSkillName),n=UI.self.gameArea.selectedCards,r=e.room.selectedPlayers;return t.viewAs&&t.viewAs(t,e,n,r,e.room.askingParam)};e.pkg.createAskingTypeContent({askingType:AskingType.UseSkill,tip:function(){var e=Game.getSkill(Game.room.askingSkillName),t=e.tip(e);return t?t:e.tipName?"您是否使用 "+e.tipName:""},minCardCount:function(e){var t=Game.getSkill(e.room.askingSkillName);return t.minCardCount},maxCardCount:function(e){var t=Game.getSkill(e.room.askingSkillName);return t.maxCardCount},filterCard:function(e,t,n){var r=Game.getSkill(e.room.askingSkillName);return r.filterCard(r,e,t,n)},filterSelect:function(e,n,r,a){if(e.length<UI.self.gameArea.minSelectCount)return!1;var i=Game.getSkill(n.room.askingSkillName);if(i.filterSelect)return i.filterSelect(i,n,e,r,a);var o=t(n);return n.room.askPlayers.includes(n)&&n.room.askingType==AskingType.PlayCard&&o&&o["class"].filterSelect?n.cardFilterSelect(o,r,a):!1},selectCorrectly:function(e,n,r){var a=Game.getSkill(n.room.askingSkillName),i=t(n),o=!0;return i&&n.room.askPlayers.includes(n)&&n.room.askingType==AskingType.PlayCard&&(o=n.cardSelectCorrectly(i,r)),o&&(o=a.selectCorrectly(a,n,e,r)),o
},btnStatus:{ok:{visible:function(){return!0},enabled:function(){return UI.self.gameArea.selectCorrectly},onClick:function(){return Game.room.selfPlayer.answer({skill:Game.room.askingSkillName,skillParam:{cardIDs:UI.self.gameArea.selectedCardIDs,selected:Game.room.selectedPlayers.map(function(e){return e.seatID})}})}},cancel:{visible:function(){return Game.getSkill(Game.room.askingSkillName).cancel},enabled:function(){return!0},onClick:function(){if(Game.room.originalAskingParam){var e=Game.room.askingSkillName;if("$"==e[0]){var t=e.slice(1);Game.room.selfPlayer.equipZoneCards.forEach(function(e){e&&e["class"].name==t&&(UI.self.gameArea.equipUI[e["class"].equipType].selected=!1)})}Game.room.selfPlayer.turnToUseSkill()}else Game.room.selfPlayer.answerNo()}},over:{visible:function(){return!1}}}}),e.pkg.createAskingTypeContent({askingType:AskingType.SelectSuit,btnStatus:{ok:{visible:function(){return!1}},cancel:{visible:function(){return!1}},over:{visible:function(){return!1}},heart:{visible:function(){return!0},enabled:function(){return Game.room.askingParam.suits.includes(Suit.Heart)},onClick:function(){return Game.room.selfPlayer.answer(Suit.Heart)}},diamond:{visible:function(){return!0},enabled:function(){return Game.room.askingParam.suits.includes(Suit.Diamond)},onClick:function(){return Game.room.selfPlayer.answer(Suit.Diamond)}},spade:{visible:function(){return!0},enabled:function(){return Game.room.askingParam.suits.includes(Suit.Spade)},onClick:function(){return Game.room.selfPlayer.answer(Suit.Spade)}},club:{visible:function(){return!0},enabled:function(){return Game.room.askingParam.suits.includes(Suit.Club)},onClick:function(){return Game.room.selfPlayer.answer(Suit.Club)}}}})},e}();__reflect(Predefined.prototype,"Predefined");var RequireType;!function(e){e[e.Package=0]="Package",e[e.CardClass=1]="CardClass",e[e.Skill=2]="Skill",e[e.General=3]="General",e[e.Mode=4]="Mode"}(RequireType||(RequireType={}));var Room=function(){function e(){var e=this;this.unknownCard=new Card(this,Game.unknownCard),this.cards=[],this.round=new Round,this.playerCount=2,this.players=[],this.askingType=AskingType.None,this.askingName="",this.askingSkillName="",this.selectedPlayers=[],this.disposeZone=[],this.syncEvents=new GameSyncEventEmitter,this.modeName="StandardIdentityMode",this.includedComponent={},this.isIncludingMode=!1,this.identitiesGuess=[],this.showTargetLine=function(t,n,r){void 0===r&&(r=0),t!=n&&(r?egret.setTimeout(function(){TargetLine.show(t.bigArea,n.bigArea)},e,2e3*r):TargetLine.show(t.bigArea,n.bigArea))}}return Object.defineProperty(e.prototype,"socket",{get:function(){return Game.socket},enumerable:!0,configurable:!0}),e.prototype.init=function(){UI.others.gameArea.initGeneralAreas(this.playerCount),this.initSocket()},e.prototype.require=function(e,t){var n=this;if(Array.isArray(e))return void e.forEach(function(e){n.require(e.type,e.name)});if(!this.includedComponent[e]||!this.includedComponent[e][t]){var r;switch(e){case RequireType.Package:r=Game.packages;break;case RequireType.CardClass:r=Game.cardClasses;break;case RequireType.Skill:r=Game.skills;break;case RequireType.General:r=Game.generals;break;case RequireType.Mode:r=Game.modes;break;default:return}var a=r[t];if(!a)throw new Error(RequireType[e]+' "'+t+'" does not exist.');if(e==RequireType.Package){for(var i=0,o=Object.keys(a.cardClasses);i<o.length;i++){var s=o[i];this.require(RequireType.CardClass,s)}for(var l=0,u=Object.keys(a.skills);l<u.length;l++){var c=u[l];this.require(RequireType.Skill,c)}for(var d=0,p=Object.keys(a.generals);d<p.length;d++){var m=p[d];this.require(RequireType.General,m)}}else{if(e==RequireType.Mode&&a["abstract"]&&!this.isIncludingMode)throw new Error('An abstract mode "'+t+'" can only be included by a mode.');if(e==RequireType.General&&a.skills.forEach(function(e){n.require(RequireType.Skill,e)}),"undefined"!=typeof a.init){var f=this.isIncludingMode;this.isIncludingMode=e==RequireType.Mode,a.init(this),this.isIncludingMode=f}}this.includedComponent[e]=this.includedComponent[e]||{},this.includedComponent[e][t]=a}},e.prototype.initSocket=function(){var e=this;this.socket.on("game begin",function(t){UI.others.gameArea.initGeneralAreas(t),e.initGame()}),this.socket.on("set seatID",function(t){e.selfPlayer.seatID=t,e.initPlayers()}),this.socket.on("set seatNum",function(t){t.forEach(function(t){e.players[t.seatID].seatNum=t.seatNum})}),this.socket.on("set maxHP",function(t){e.players[t.seatID].maxHP=t.maxHP}),this.socket.on("set HP",function(t){t.HP<e.players[t.seatID].HP&&(Sound.playSound("Hurt"),"number"==typeof t.source&&e.playHurtEffect(e.players[t.seatID]),e.playLoseHPEffect(e.players[t.seatID],e.players[t.seatID].HP,t.HP)),e.players[t.seatID].HP=t.HP}),this.socket.on("set alive",function(t){!t.alive&&e.players[t.seatID].general&&Sound.playDeadSound(e.players[t.seatID].general),e.players[t.seatID].alive=t.alive}),this.socket.on("move card",function(t){if(t.commonCards=e.getCardsByID(t.cardIDs),t.realCards=t.commonCards.slice(),t.cards=t.commonCards.slice(),t.virtualCardsInfo?(t.virtualCards=t.virtualCardsInfo.map(function(t){return e.makeVirtualCard(t.className,e.getCardsByID(t.cardIDs))}),(r=t.cards).push.apply(r,t.virtualCards),(a=t.realCards).push.apply(a,t.virtualCards.reduce(function(e,t){return e.push.apply(e,t.realCards),e},[]))):t.virtualCards=[],t.allCards=t.virtualCards.concat(t.realCards),e.moveCardEffect(t),e.moveCardSound(t),t.allCards.forEach(function(e){e.zone=t.toZone,e.seatID=t.toSeatID}),t.fromZone==Zone.Hand)e.players[t.fromSeatID].removeHandCards(t.cards);else if(t.fromZone==Zone.Dispose)Game.getCardIDs(t.realCards).forEach(function(t){for(var n=0;n<e.disposeZone.length;n++)e.disposeZone[n].cardID==t&&(e.disposeZone.splice(n,1),n--)});else if(t.fromZone==Zone.Judge){var n=e.players[t.fromSeatID];n.removeFromJudgeZone(t.commonCards.concat(t.virtualCards))}else t.fromZone==Zone.Equip&&t.cards.forEach(function(n){"undefined"!=typeof n["class"].equipType&&e.players[t.fromSeatID].setEquip(n["class"].equipType,void 0)});t.toZone==Zone.Hand?e.players[t.toSeatID].addHandCards(t.realCards):t.toZone==Zone.Dispose?(i=e.disposeZone).push.apply(i,t.realCards):t.toZone==Zone.Judge?e.players[t.toSeatID].addToJudgeZone(t.cards):t.toZone==Zone.Equip&&t.cards.forEach(function(n){"undefined"!=typeof n["class"].equipType&&e.players[t.toSeatID].setEquip(n["class"].equipType,n)});var r,a,i}),this.socket.on("set round",function(t){e.round.began=!1,e.round.phase=0,e.round.player=e.players[t.seatID],e.refreshPhase()}),this.socket.on("round begin",function(){e.round.began=!0,e.refreshPhase()}),this.socket.on("set phase",function(t){e.round.phase=t.phase,e.refreshPhase()}),this.socket.on("get skill",function(t){e.players[t.seatID].getSkill(t.skillName)}),this.socket.on("set general",function(t){e.players[t.seatID].general=Game.getGeneral(t.generalName)}),this.socket.on("set country",function(t){e.players[t.seatID].country=t.country}),this.socket.on("set sex",function(t){e.players[t.seatID].sex=t.sex}),this.socket.on("set identity",function(t){e.players[t.seatID].identity=t.identity}),this.socket.on("set back",function(t){e.players[t.seatID].back=t.back}),this.socket.on("set flag",function(t){e.players[t.seatID].setFlag(t.key,t.value)}),this.socket.on("ask play card",function(t){t.seatID==e.selfPlayer.seatID&&e.selfPlayer.askPlaycard()}),this.socket.on("ask discard",function(t){t.seatID==e.selfPlayer.seatID&&e.selfPlayer.askDiscard(t.askingName,t.param)}),this.socket.on("ask respond card",function(t){t.seatID==e.selfPlayer.seatID&&e.selfPlayer.askRespondCard(t.askingName,t.param)}),this.socket.on("ask use card",function(t){t.seatIDs?t.seatIDs.includes(e.selfPlayer.seatID)&&e.selfPlayer.askUseCard(t.askingName,t.param):t.seatID==e.selfPlayer.seatID&&e.selfPlayer.askUseCard(t.askingName,t.param)}),this.socket.on("ask select cards in window",function(t){if(t.seatID==e.selfPlayer.seatID){var n=0;t.param.cards=t.param.cardIDs.map(function(r){var a;if(0==r&&(a=t.param.classNames[n++])){var i=e.makeVirtualCard(a);return i.zone=Zone.Judge,i}return e.getCardByID(r)}),delete t.param.cardIDs,e.selfPlayer.askSelectCardsInWindow(t.askingName,t.param)}}),this.socket.on("show global cards window",function(t){new GlobalCardSelectorWindow(t.title,e.getCardsByID(t.cardIDs)).show()}),this.socket.on("set global cards window title",function(e){UI.sceneGame.globalCardSelectorWindow.title=e}),this.socket.on("ask select global card in window",function(t){t.seatID==e.selfPlayer.seatID&&e.selfPlayer.askSelectGlobalCardInWindow()}),this.socket.on("global card selected",function(e){UI.sceneGame.globalCardSelectorWindow.dark(e.cardID)}),this.socket.on("close global cards window",function(){UI.sceneGame.globalCardSelectorWindow.exit()}),this.socket.on("ask use skill",function(t){t.seatID==e.selfPlayer.seatID&&e.selfPlayer.askUseSkill(t.skillName,t.param)}),this.socket.on("ask select suit",function(t){t.seatID==e.selfPlayer.seatID&&e.selfPlayer.askSelectSuit(t.askingName,t.param)}),this.socket.on("end ask",function(){e.selfPlayer.endAsk()}),this.socket.on("use card",function(t){var n=t.cardClassFullName,r=Game.cardClasses[n];Sound.playCardSound(e.players[t.seatID].sex,n),e.playCardEffect(e.players[t.seatID],n,t.color),e.showTargetLines(r,e.players[t.seatID],t.selected.map(function(t){return e.players[t]}))}),this.socket.on("respond card",function(t){var n=t.cardClassFullName;Sound.playCardSound(e.players[t.seatID].sex,n),e.playCardEffect(e.players[t.seatID],n,t.color)}),this.socket.on("use skill",function(t){var n=Game.getSkill(t.skillName);Sound.playSkillSound(t.skillName),e.playSkillEffect(e.players[t.seatID],t.skillName),t.selected&&e.showTargetLines(n,e.players[t.seatID],t.selected.map(function(t){return e.players[t]}))}),this.socket.on("get dying",function(e){UI.generalArea(e).helpMe=!0}),this.socket.on("cancel dying",function(e){UI.generalArea(e).helpMe=!1}),this.socket.on("play sound",function(e){Sound.playSound(e)}),this.socket.on("play effect",function(t){e.playEffect(e.players[t.seatID],"Effect_"+t.name,t.pos)}),this.socket.emit("join room","1111")},e.prototype.moveCardEffect=function(e){var t=this,n=e.fromSeatID==this.selfPlayer.seatID,r=e.toSeatID==this.selfPlayer.seatID,a=!1;if(n){if(e.fromZone==Zone.Hand)Game.getCardIDs(e.realCards).forEach(function(n){if(!UI.sceneGame.disposeZoneUI.some(function(e){return e.data.cardID==n})){var r=UI.self.gameArea.getCardRenderer(n);if(r){var i=UI.self.gameArea.list_handCards,o=new CardRenderer;if(o.data=r.data,o.data.dark=!1,o.x=UI.self.gameArea.x+i.parent.x+r.x,o.y=UI.self.gameArea.y+i.parent.y+r.y,UI.sceneGame.group_movingCards.addChild(o),e.toZone==Zone.Hand){var s=t.players[e.toSeatID],l=s.generalArea;l.y+4;egret.Tween.get(o).to({x:l.x+l.width/2-o.width/2,y:l.y+4},500).call(function(){return UI.sceneGame.group_movingCards.removeChild(o)})}else UI.sceneGame.disposeZoneUI.push(o),a=!0}}});else if(e.fromZone==Zone.Judge||e.fromZone==Zone.Equip){var i,o,s=.5,l=UI.self.gameArea.y-10;if(e.toZone==Zone.Hand){var u,c=new eui.Group;if(e.realCards.slice().reverse().every(function(t,n){var r=new CardRenderer;return u=u||r.height,i=i||r.width*e.realCards.length-r.width*s*(e.realCards.length-1),o=o||UI.self.gameArea.x+UI.self.gameArea.width/2-i/2,r.data=Game.makeCardUIData(t),r.x=(1-s)*r.width*n,r.y=0,c.addChild(r),!0}),c.x=o,c.y=l,UI.sceneGame.group_movingCards.addChild(c),r)egret.Tween.get(c).to({x:UI.sceneGame.width-i-20,y:UI.sceneGame.height-u-5},500).call(function(){return UI.sceneGame.group_movingCards.removeChild(c)});else{var d=this.players[e.toSeatID].generalArea;egret.Tween.get(c).to({x:d.x+d.width/2-i/2,y:d.y+4},500).call(function(){return UI.sceneGame.group_movingCards.removeChild(c)})}}else e.realCards.slice().reverse().every(function(t,n){var r=t.cardID;if(UI.sceneGame.disposeZoneUI.some(function(e){return e.data.cardID==r}))return!0;var u=new CardRenderer;return i=i||u.width*e.realCards.length-u.width*s*(e.realCards.length-1),o=o||UI.self.gameArea.x+UI.self.gameArea.width/2-i/2,u.data=Game.makeCardUIData(t),u.x=o+(1-s)*u.width*n,u.y=l,UI.sceneGame.disposeZoneUI.push(u),UI.sceneGame.group_movingCards.addChild(u),a=!0,!0})}}else if(-1!=e.fromSeatID){if(e.fromZone==Zone.Hand||e.fromZone==Zone.Judge||e.fromZone==Zone.Equip){var p,m,f=this.players[e.fromSeatID],h=.5,g=f.generalArea,y=g.y+4;if(e.toZone==Zone.Hand){var C,k=new eui.Group;e.realCards.slice().reverse().every(function(t,n){var r=new CardRenderer;return C=C||r.height,p=p||r.width*e.realCards.length-r.width*h*(e.realCards.length-1),m=m||g.x+g.width/2-p/2,r.data=Game.makeCardUIData(t),r.x=(1-h)*r.width*n,r.y=0,k.addChild(r),!0}),k.x=m,k.y=y,UI.sceneGame.group_movingCards.addChild(k),r?egret.Tween.get(k).to({x:UI.sceneGame.width-p-20,y:UI.sceneGame.height-C-5},500).call(function(){return UI.sceneGame.group_movingCards.removeChild(k)}):egret.Tween.get(k).to({x:g.x+g.width/2-p/2,y:g.y+4},500).call(function(){return UI.sceneGame.group_movingCards.removeChild(k)})}else e.realCards.slice().reverse().every(function(t,n){var r=t.cardID;if(UI.sceneGame.disposeZoneUI.some(function(e){return e.data.cardID==r}))return!0;var i=new CardRenderer;return p=p||i.width*e.realCards.length-i.width*h*(e.realCards.length-1),m=m||g.x+g.width/2-p/2,i.data=Game.makeCardUIData(t),i.x=m+(1-h)*i.width*n,i.y=y,UI.sceneGame.disposeZoneUI.push(i),UI.sceneGame.group_movingCards.addChild(i),a=!0,!0})}}else if(e.fromZone==Zone.Dispose)if(e.toZone==Zone.Hand)if(r)UI.sceneGame.disappearFromDisposeZoneUI(Game.getCardIDs(e.realCards));else{var S,f=this.players[e.toSeatID],v=UI.sceneGame.disposeZoneUI.filter(function(t){return e.realCards.includes(t.data.cardID)}),b=.5,P=f.generalArea,T=229;v.slice().reverse().every(function(t,n){var r=UI.sceneGame.disposeZoneUI.indexOf(t);return UI.sceneGame.disposeZoneUI.splice(r,1),a=!0,egret.Tween.removeTweens(t),t.tw_moving=t.tw_disappearing=void 0,S=S||t.width*e.realCards.length-t.width*b*(e.realCards.length-1),egret.Tween.get(t).to({x:P.x+P.width/2-S/2+(1-b)*t.width*n,y:P.y+4},300).call(function(){UI.sceneGame.group_movingCards.removeChild(t)}),!0})}else UI.sceneGame.disappearFromDisposeZoneUI(Game.getCardIDs(e.realCards));else if(e.fromZone==Zone.CardPile)if(e.toZone==Zone.Dispose)e.cards.forEach(function(e){if(!UI.sceneGame.disposeZoneUI.some(function(t){return t.data.cardID==e.cardID})){var t=new CardRendererWithBack(Game.makeCardUIData(e));UI.sceneGame.disposeZoneUI.push(t),UI.sceneGame.group_movingCards.addChild(t),a=!0}});else if(e.toZone==Zone.Hand&&!r){var E,G,f=this.players[e.toSeatID],_=.5,d=f.generalArea,T=229,I=new eui.Group;Game.getCardIDs(e.realCards).slice().reverse().every(function(n,r){var a=t.getCardByID(n),i=new CardRenderer;return E=E||i.width*e.realCards.length-i.width*_*(e.realCards.length-1),G=G||471-E/2,i.data=Game.makeCardUIData(a),i.x=(1-_)*i.width*r,i.y=0,I.addChild(i),!0}),I.x=G,I.y=T,UI.sceneGame.group_movingCards.addChild(I),egret.Tween.get(I).to({x:d.x+d.width/2-E/2,y:d.y+4},300).call(function(){UI.sceneGame.group_movingCards.removeChild(I)})}(e.toZone==Zone.Judge||e.toZone==Zone.Equip)&&UI.sceneGame.disappearFromDisposeZoneUI(Game.getCardIDs(e.realCards)),UI.sceneGame.refreshDisposeZoneUI()},e.prototype.moveCardSound=function(e){var t=e.cards;e.toZone==Zone.Equip&&t.forEach(function(e){switch(e["class"].equipType){case EquipType.Arm:Sound.playSound("EquipArm");break;case EquipType.Armor:Sound.playSound("EquipArm");break;case EquipType.PlusHorse:case EquipType.MinusHorse:Sound.playSound("EquipHorse")}})},e.prototype.playEffect=function(e,t,n){if(void 0===n&&(n=EffectPosition.General),RES.hasRes(t+"_json")){var r=RES.getRes(t+"_json"),a=RES.getRes(t+"_png"),i=new egret.MovieClipDataFactory(r,a),o=new egret.MovieClip(i.generateMovieClipData(t)),s=UI.bigArea(e.seatID);o.scaleX=.8,o.scaleY=.6,n==EffectPosition.Middle||n==EffectPosition.Right?(o.x=e==this.selfPlayer?s.x+(s.width-UI.self.generalArea.width)/2:s.x,n==EffectPosition.Right&&(o.x+=70),o.y=s.y+s.height/2-(e==this.selfPlayer?50:0),UI.sceneGame.addChild(o),o.gotoAndPlay(1,1),o.addEventListener(egret.Event.COMPLETE,function(){return UI.sceneGame.removeChild(o)},this)):n==EffectPosition.General&&UI.generalArea(e.seatID).playEffect(o)}},e.prototype.playCardEffect=function(e,t,n){n==Color.None&&(n=Color.Red);var r=["CardEffect_"+t+"_"+Game.getColorName(n),"CardEffect_"+t],a=r.find(function(e){return RES.hasRes(e+"_json")});this.playEffect(e,a,EffectPosition.Middle)},e.prototype.playSkillEffect=function(e,t){this.playEffect(e,"SkillEffect_"+t,EffectPosition.Right)},e.prototype.playHurtEffect=function(e){var t=RES.getRes("Effect_Hurt_json"),n=RES.getRes("Effect_Hurt_png"),r=new egret.MovieClipDataFactory(t,n),a=new egret.MovieClip(r.generateMovieClipData("Effect_Hurt")),i=(UI.bigArea(e.seatID),UI.generalArea(e.seatID));a.scaleX=.7,a.scaleY=.5,i.playEffect(a)},e.prototype.playLoseHPEffect=function(e,t,n){for(var r=RES.getRes("Effect_LoseHP_json"),a=RES.getRes("Effect_LoseHP_png"),i=new egret.MovieClipDataFactory(r,a),o=[],s=t-n,l=0;s>l;l++){var u=new egret.MovieClip(i.generateMovieClipData("Effect_LoseHP"));u.scaleX=.8,u.scaleY=.6,o.push(u)}UI.generalArea(e.seatID).HPArea.playLoseHPEffect(t,n,o)},e.prototype.showTargetLines=function(e,t,n){e.showTargetLines(t,n,this.showTargetLine)},e.prototype.initGame=function(){var e=this;if(this.disposeZone=[],this.players=[],this.selfPlayer){this.selfPlayer.removeHandCards(this.selfPlayer.hand.slice()),this.selfPlayer.removeFromJudgeZone(this.selfPlayer.judgeZone.slice()),this.selfPlayer.setEquip(EquipType.Arm,void 0),this.selfPlayer.setEquip(EquipType.Armor,void 0),this.selfPlayer.setEquip(EquipType.PlusHorse,void 0),this.selfPlayer.setEquip(EquipType.MinusHorse,void 0),this.selfPlayer.identity=Identity.Unknown,this.selfPlayer.back=!1;var t=this.selfPlayer.seatID;this.selfPlayer=new SelfPlayer,this.selfPlayer.seatID=t,this.selfPlayer.endAsk(),this.selfPlayer.seatID=-1}else this.selfPlayer=new SelfPlayer,this.selfPlayer.endAsk();this.round.player=void 0,this.round.began=!1,this.round.phase=0,UI.self.generalArea.helpMe=!1,UI.sceneGame.globalCardSelectorWindow&&UI.sceneGame.globalCardSelectorWindow.exit(),UI.sceneGame.disposeZoneUI.forEach(function(e){UI.sceneGame.group_movingCards.removeChild(e)}),UI.sceneGame.disposeZoneUI=[],UI.self.generalArea.skills=[],this.initEvents(),this.cards=[],this.cardIDs.forEach(function(t){var n=new Card(e,Game.getCardByID(t));n.zone=Zone.CardPile,e.cards.push(n)}),delete this.cardIDs},e.prototype.initEvents=function(){this.includedComponent={},this.syncEvents=new GameSyncEventEmitter,this.cardIDs=new Set,this.require(RequireType.Package,"predefined"),this.require(RequireType.Mode,this.modeName)},e.prototype.initPlayers=function(){for(var e=0;e<this.playerCount;e++){var t=e==this.selfPlayer.seatID?this.selfPlayer:new Player;t.seatID=e,this.players.push(t)}},Object.defineProperty(e.prototype,"alivePlayers",{get:function(){return this.players.filter(function(e){return e.alive})},enumerable:!0,configurable:!0}),e.prototype.refreshPhase=function(){this.players.forEach(function(e){e.refreshPhase()})},e.prototype.getCardByID=function(e){if(0==e)return this.unknownCard;var t=this.cards.find(function(t){return t.cardID==e});return t=t||this.unknownCard},e.prototype.getCardsByID=function(e){var t=this;return e.map(function(e){return t.getCardByID(e)})},e.prototype.makeVirtualCard=function(e,t){void 0===t&&(t=[]);var n=new Card(this,{cardID:0,"class":e,number:1==t.length?t[0].number:0,suit:Suit.None});return n.virtual=!0,n.realCards=t,n},e.prototype.makeUnknownCards=function(e){return new Array(e).fill(this.unknownCard)},e.prototype.askingMatch=function(e,t){return e==AskingType.UseSkill?t&&t==this.askingSkillName:e!=this.askingType?!1:t&&t!=this.askingName?!1:!0},e}();__reflect(Room.prototype,"Room");var Round=function(){function e(){}return e}();__reflect(Round.prototype,"Round");var SelfPlayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"self",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.handCardsChange=function(){UI.self.gameArea.handCardsCollection.removeAll(),this.hand.forEach(function(e){UI.self.gameArea.handCardsCollection.addItem(Game.makeCardUIData(e))}),e.prototype.handCardsChange.call(this)},t.prototype.getSkill=function(t){e.prototype.getSkill.call(this,t),UI.self.generalArea.skills=this.skills},t.prototype.makeAskingParam=function(e,t,n){var r=Object.assign({},Game.getAskingTypeContents(e));if(e!=AskingType.UseSkill){var a=Game.getAsking(t);Object.assign(r,a&&a.param)}return Object.assign(r,n),r},t.prototype.initAskingParam=function(e){this.room.askingParam=this.makeAskingParam(this.room.askingType,this.room.askingName,e)},t.prototype.askPlaycard=function(){this.room.askPlayers=[this],this.room.askingType=AskingType.PlayCard,this.room.askingName="",this.initAskingParam(),this.applyAsking()},t.prototype.askDiscard=function(e,t){this.room.askPlayers=[this],this.room.askingType=AskingType.Discard,this.room.askingName=e,this.initAskingParam(t),this.applyAsking()},t.prototype.askRespondCard=function(e,t){this.room.askPlayers=[this],this.room.askingType=AskingType.RespondCard,this.room.askingName=e,this.initAskingParam(t),this.applyAsking()},t.prototype.askUseCard=function(e,t){this.room.askPlayers=[this],this.room.askingType=AskingType.UseCard,this.room.askingName=e,this.initAskingParam(t),this.applyAsking()},t.prototype.askSelectCardsInWindow=function(e,t){this.room.askPlayers=[this],this.room.askingType=AskingType.SelectCardInWindow,this.room.askingName=e,this.initAskingParam(t);var n=[[],[],[]],r=n[0],a=n[1],i=n[2];this.room.askingParam.cards.forEach(function(e){e.zone==Zone.Equip?a.push(e):e.zone==Zone.Judge?i.push(e):r.push(e)}),new CardSelectorWindow({title:this.room.askingParam.title?this.room.askingParam.title():"",cardCount:this.room.askingParam.cardCount,hand:r,equip:a,judge:i}).show()},t.prototype.askSelectGlobalCardInWindow=function(){this.room.askPlayers=[this],this.room.askingType=AskingType.SelectGlobalCardInWindow,this.room.askingName="",UI.sceneGame.globalCardSelectorWindow.canSelect=!0},t.prototype.askUseSkill=function(e,t){this.room.askPlayers=[this],this.room.askingType=AskingType.UseSkill,this.room.askingSkillName=e,this.initAskingParam(t),this.applyAsking()},t.prototype.askSelectSuit=function(e,t){this.room.askPlayers=[this],this.room.askingType=AskingType.SelectSuit,this.room.askingName=e,this.initAskingParam(t),this.applyAsking()},t.prototype.applyAsking=function(){var e,t=this;e=this.room.originalAskingParam?this.makeAskingParam(AskingType.UseSkill,""):this.room.askingParam,UI.self.gameArea.maxSelectCount=e.maxCardCount(Game.room.selfPlayer),UI.self.gameArea.minSelectCount=e.minCardCount(Game.room.selfPlayer),UI.self.gameArea.selectedCards=[],UI.self.gameArea.refreshEquipCanSelect(),this.equipZoneCards.forEach(function(e){var n="$"+e["class"].name,r=t.skills.find(function(e){return e.name==n})||Game.getSkill(n);if(Game.room.selfPlayer.hasSkill(n)&&r.enabled(t)){if(t.room.askingSkillName&&t.room.askingSkillName!=n)return;var a=r.filterCard!=Package.skillFilterCardDefault||r.filterSelect,i=!!t.room.originalAskingParam;a?UI.self.gameArea.equipUI[e["class"].equipType].setCallback({unselected:function(){i?t.answerNo():Game.room.selfPlayer.applyAsking()},selected:function(){Game.room.selfPlayer.turnToUseSkill(r.name)}}):UI.self.gameArea.equipUI[e["class"].equipType].setCallback({selected:function(){Game.room.selfPlayer.answer({skill:r.name})}}),i&&a&&(UI.self.gameArea.equipUI[e["class"].equipType].selected=!0)}}),UI.self.gameArea.refreshCardStatus(),UI.self.gameArea.clearSelectedHandCards(),UI.self.operationArea.refreshButtonStatus(),UI.self.generalArea.cancelSelectedSkill(),UI.self.generalArea.refreshSkillButtons(),UI.sceneGame.clearPlayerSelect(),UI.sceneGame.refreshPlayerSelect(),UI.sceneGame.refreshTip()},t.prototype.turnToUseSkill=function(e){void 0===e&&(e=""),this.room.askingSkillName=e,e?(this.room.originalAskingParam=this.room.askingParam,this.room.askingParam=this.makeAskingParam(AskingType.UseSkill,"")):(this.room.askingParam=this.room.originalAskingParam,this.room.originalAskingParam=void 0),this.applyAsking()},t.prototype.getAnswerEventName=function(){switch(Game.room.askingType){case AskingType.UseCard:case AskingType.PlayCard:return"use card";case AskingType.Discard:return"discard";case AskingType.RespondCard:return"respond card";case AskingType.UseSkill:return"use skill";case AskingType.SelectSuit:return"select suit";default:throw new Error("unknown askingType")}},t.prototype.answer=function(e){Game.socket.emit(this.getAnswerEventName(),e),this.endAsk()},t.prototype.answerNo=function(){var e;e=Game.room.askingType==AskingType.PlayCard?"end play card":"do not "+this.getAnswerEventName(),Game.socket.emit(e),this.endAsk()},t.prototype.endAsk=function(){this.room.askPlayers=[this],this.room.askingType=AskingType.None,this.room.askingName="",this.room.originalAskingParam=void 0,this.room.askingParam=void 0,this.room.askingSkillName="",UI.self.gameArea.selectedCards=[],UI.self.gameArea.maxSelectCount=UI.self.gameArea.maxSelectCount=0,UI.self.gameArea.refreshCardStatus(),UI.self.gameArea.equipUI.forEach(function(e){return e.canSelect=!1}),UI.self.gameArea.clearSelectedHandCards(),UI.self.operationArea.refreshButtonStatus(),UI.self.generalArea.cancelSelectedSkill(),UI.self.generalArea.refreshSkillButtons(),UI.sceneGame.clearPlayerSelect(),UI.sceneGame.refreshTip()},t}(Player);__reflect(SelfPlayer.prototype,"SelfPlayer");var Sex;!function(e){e[e.None=0]="None",e[e.Male=1]="Male",e[e.Female=2]="Female"}(Sex||(Sex={}));var Skill=function(){function e(e){"string"==typeof e&&(e=Game.getSkill(e)),this.data=e}return Object.defineProperty(e.prototype,"package",{get:function(){return this.data["package"]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.data.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tipName",{get:function(){return this.data.tipName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emperor",{get:function(){return this.data.emperor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.data.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this.data.enabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tip",{get:function(){return this.data.tip},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minCardCount",{get:function(){return this.data.minCardCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCardCount",{get:function(){return this.data.maxCardCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterCard",{get:function(){return this.data.filterCard},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterSelect",{get:function(){return this.data.filterSelect},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectCorrectly",{get:function(){return this.data.selectCorrectly},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showTargetLines",{get:function(){return this.data.showTargetLines},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancel",{get:function(){return this.data.cancel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewAs",{get:function(){return this.data.viewAs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"init",{get:function(){return this.data.init},enumerable:!0,configurable:!0}),e}();__reflect(Skill.prototype,"Skill",["ISkill"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Suit;!function(e){e[e.None=0]="None",e[e.Heart=1]="Heart",e[e.Diamond=2]="Diamond",e[e.Spade=3]="Spade",e[e.Club=4]="Club"}(Suit||(Suit={}));var Zone;!function(e){e[e.Hand=1]="Hand",e[e.CardPile=2]="CardPile",e[e.DiscardPile=3]="DiscardPile",e[e.Dispose=4]="Dispose",e[e.Judge=5]="Judge",e[e.Equip=6]="Equip"}(Zone||(Zone={})),Package.card.ex=function(){var e=Game.createPackage("ex");e.createSkill({name:"$RenWangDun",type:SkillType.Lock}),e.createCardClass({name:"RenWangDun",tipName:"仁王盾",type:CardType.Equip,equipType:EquipType.Armor,enabled:!0,tip:"装备仁王盾",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$RenWangDun"==t?e.hasEquip("RenWangDun"):void 0})}}),e.createAsking({name:"HanBingJian",param:{tip:function(){var e=Game.room.selfPlayer,t=Game.room.players[Game.room.askingParam.target];return"<font color=0xffd800>寒冰剑</font> <font>选择弃置一张"+(t.name+(e==t?"(你)":""))+"的卡牌</font>"},cardCount:1}}),e.createSkill({name:"$HanBingJian",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"$HanBingJian")},tipName:"寒冰剑"}),e.createCardClass({name:"HanBingJian",tipName:"寒冰剑",type:CardType.Equip,equipType:EquipType.Arm,attackRange:2,enabled:!0,tip:"装备寒冰剑",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$HanBingJian"==t?e.hasEquip("HanBingJian"):void 0})}})},Package.card.std=function(){var e=Game.createPackage("std/general");e.createCardClass({name:"Sha",tipName:"杀",type:CardType.Basic,enabled:function(e,t){return!t.limitUseCount(e)||t.getFlag("useShaCount")<1},tip:function(e){var t=Game.room.selfPlayer.extraMaxTargetCount(e);return 0==t?"请选择1名角色，作为杀的目标":"可选择最多"+(1+t)+"名角色，作为杀的目标"},filterSelect:function(e,t,n,r){return n.length==1+t.extraMaxTargetCount(e)?[]:r.filter(function(n){return n!=t&&(!n.limitDistance(e)||n.inAttackRange(t))})},selectCorrectly:function(e,t,n){return n.length>0&&n.length<=1+t.extraMaxTargetCount(e)&&n.every(function(e){return e!=t&&e.inAttackRange(t)})}}),e.createAsking({name:"Shan",param:{tip:function(){var e=Game.room.players[Game.room.askingParam.source],t=Game.room.players[Game.room.askingParam.target];return"<font color=0xafff7d>"+(e.name+(e==t?"(你)":""))+"</font>对你使用了一张杀，请使用一张闪"},cardClassName:"Shan"}}),e.createCardClass({name:"Shan",tipName:"闪",type:CardType.Basic,enabled:!1}),e.createAsking({name:"Tao",param:{tip:function(){var e=Game.room.players[Game.room.askingParam.dyingPlayer],t=Game.room.players[Game.room.askingParam.currentPlayer],n=Game.room.askingParam.delta;return"<font color=0xafff7d>"+(e.name+(t==e?"(你)":""))+"</font>处于濒死状态，请求<font color=0xafff7d>"+t.name+"(你)</font>出"+n+"个【桃】"},cardClassName:"Tao"}}),e.createCardClass({name:"Tao",tipName:"桃",type:CardType.Basic,enabled:function(e,t){return t.wounded},tip:"使用桃你可回复1点体力"}),e.createCardClass({name:"WuZhongShengYou",tipName:"无中生有",type:CardType.Bag,enabled:!0,tip:"你可摸两张牌"}),e.createAsking({name:"NanManRuQin",param:{tip:function(){var e=Game.room.players[Game.room.askingParam.source],t=Game.room.players[Game.room.askingParam.target];return"<font color=0xafff7d>"+(e.name+(e==t?"(你)":""))+"</font>使用了南蛮入侵，请打出一张杀"},cardClassName:"Sha"}}),e.createCardClass({name:"NanManRuQin",tipName:"南蛮入侵",type:CardType.Bag,enabled:!0,tip:"使用南蛮入侵"}),e.createAsking({name:"WanJianQiFa",param:{tip:function(){var e=Game.room.players[Game.room.askingParam.source],t=Game.room.players[Game.room.askingParam.target];return"<font color=0xafff7d>"+(e.name+(e==t?"(你)":""))+"</font>使用了万箭齐发，请打出一张闪"},cardClassName:"Shan"}}),e.createCardClass({name:"WanJianQiFa",tipName:"万箭齐发",type:CardType.Bag,enabled:!0,tip:"使用万箭齐发"}),e.createCardClass({name:"TaoYuanJieYi",tipName:"桃园结义",type:CardType.Bag,enabled:!0,tip:"使用桃园结义"}),e.createAsking({name:"WuXieKeJi",param:{tip:function(){var e=Game.room.selfPlayer,t=Game.room.players[Game.room.askingParam.asker],n=Game.cardClasses[Game.room.askingParam.causeCardClassName];
return"<font color=0xafff7d>"+(t?t.name+(t==e?"(你)":""):"")+"</font>为"+n.tipName+"询问无懈，是否使用无懈可击？"},cardClassName:"WuXieKeJi"}}),e.createCardClass({name:"WuXieKeJi",tipName:"无懈可击",type:CardType.Bag,enabled:!1}),e.createAsking({name:"JueDou",param:{tip:function(){var e=Game.room.selfPlayer,t=Game.room.players[Game.room.askingParam.source];return"<font color=0xafff7d>"+(t.name+(t==e?"(你)":""))+"</font>与你决斗，请打出一张杀"},cardClassName:"Sha"}}),e.createCardClass({name:"JueDou",tipName:"决斗",type:CardType.Bag,enabled:!0,tip:function(e){var t=Game.room.selfPlayer.extraMaxTargetCount(e);return 0==t?"请选择一个目标与其决斗":"请选择"+(1+t)+"个目标与其决斗"},filterSelect:function(e,t,n,r){return n.length==1+t.extraMaxTargetCount(e)?[]:r.filter(function(e){return e!=t})},selectCorrectly:function(e,t,n){return n.length>0&&n.length<=1+t.extraMaxTargetCount(e)&&n.every(function(e){return e!=t})}}),e.createAsking({name:"GuoHeChaiQiao",param:{title:function(){var e=Game.room.players[Game.room.askingParam.target];return"<font color=0xffd800>过河拆桥</font> <font>选择弃置一张"+e.name+"的卡牌</font>"},cardCount:1}}),e.createCardClass({name:"GuoHeChaiQiao",tipName:"过河拆桥",type:CardType.Bag,enabled:!0,tip:function(e){var t=Game.room.selfPlayer.extraMaxTargetCount(e);return 0==t?"请选择一个目标，弃置其一张牌":"请选择"+(1+t)+"个目标，弃置每个目标各一张牌"},filterSelect:function(e,t,n,r){return n.length==1+t.extraMaxTargetCount(e)?[]:r.filter(function(e){return e!=t&&e.hasZoneCard})},selectCorrectly:function(e,t,n){return n.length>0&&n.length<=1+t.extraMaxTargetCount(e)&&n[0]!=t&&n[0].hasZoneCard}}),e.createAsking({name:"ShunShouQianYang",param:{title:function(){var e=Game.room.players[Game.room.askingParam.target];return"<font color=0xffd800>顺手牵羊</font> <font>请选择一张"+e.name+"的卡牌</font>"},cardCount:1}}),e.createCardClass({name:"ShunShouQianYang",tipName:"顺手牵羊",type:CardType.Bag,enabled:!0,tip:function(e){var t=Game.room.selfPlayer.extraMaxTargetCount(e);return 0==t?"请选择一个目标，获得其一张牌":"请选择"+(1+t)+"个目标，获得每个目标各一张牌"},filterSelect:function(e,t,n,r){return n.length==1+t.extraMaxTargetCount(e)?[]:r.filter(function(n){return n!=t&&(!n.limitDistance(e)||1==t.distanceTo(n))&&n.hasZoneCard})},selectCorrectly:function(e,t,n){return n.length>0&&n.length<=1+t.extraMaxTargetCount(e)&&n.every(function(e){return 1==t.distanceTo(e)&&e!=t&&e.hasZoneCard})}}),e.createCardClass({name:"WuGuFengDeng",tipName:"五谷丰登",type:CardType.Bag,enabled:!0,tip:"五谷丰登"}),e.createAsking({name:"JieDaoShaRen",param:{tip:function(){var e=(Game.room.players[Game.room.askingParam.targets[0]],Game.room.players[Game.room.askingParam.source]),t=Game.room.players[Game.room.askingParam.target];return"<font color=0xafff7d>"+(e.name+(e==t?"(你)":""))+"</font>对你使用借刀杀人，请你使用【杀】，否则你装备的武器将归<font color=0xafff7d>"+e.name+"</font>所有"},cardClassName:"Sha"}}),e.createCardClass({name:"JieDaoShaRen",tipName:"借刀杀人",type:CardType.Bag,enabled:!0,tip:"选择一名装备区有武器的角色杀另一名角色，若其不杀，则其须将武器交给你",filterSelect:function(e,t,n,r){return n.length==2*(1+t.extraMaxTargetCount(e))?[]:n.length%2==0?r.filter(function(e){return e!=t&&e.hasEquipType(EquipType.Arm)}):r.filter(function(e){return e.inAttackRange(n[n.length-1])})},selectCorrectly:function(e,t,n){if(!(n.length>0&&n.length%2==0&&n.length<=2*(1+t.extraMaxTargetCount(e))))return!1;var r=n.reduce(function(e,t,r){return r%2==1&&e.push([n[r-1],t]),e},[]);return r.every(function(e){var n=e[0],r=e[1];return n!=t&&n.hasEquipType(EquipType.Arm)&&r.inAttackRange(n)})},showTargetLines:function(e,t,n){var r=t.reduce(function(e,n,r){return r%2==1&&e.push([t[r-1],n]),e},[]);r.forEach(function(t){var r=t[0],a=t[1];n(e,r),n(r,a,1)})}}),e.createCardClass({name:"LeBuSiShu",tipName:"乐不思蜀",type:CardType.Bag,delay:!0,enabled:!0,tip:"将乐不思蜀置入目标的判定区",filterSelect:function(e,t,n,r){return 1==n.length?[]:r.filter(function(e){return e!=t})},selectCorrectly:function(e,t,n){return 1==n.length&&n[0]!=t}}),e.createCardClass({name:"ShanDian",tipName:"闪电",type:CardType.Bag,delay:!0,enabled:function(e,t){return!t.hasCardClassInJudgeZone("ShanDian")},tip:"将闪电置入你的判定区"}),e.createSkill({name:"$BaGuaZhen",tipName:"八卦阵",type:SkillType.Lock,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"$BaGuaZhen")},init:function(e){e.require(RequireType.CardClass,"Shan")}}),e.createCardClass({name:"BaGuaZhen",tipName:"八卦阵",type:CardType.Equip,equipType:EquipType.Armor,enabled:!0,tip:"装备八卦阵",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$BaGuaZhen"==t?e.hasEquip("BaGuaZhen"):void 0})}}),Predefined.createPlusHorse(e,{DiLu:"的卢",JueYing:"绝影",ZhuaHuangFeiDian:"爪黄飞电"}),Predefined.createMinusHorse(e,{ChiTu:"赤兔",DaYuan:"大宛",ZiXing:"紫骍"}),e.createSkill({name:"$GuanShiFu",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"$GuanShiFu")},filterCard:!0,tip:function(){return"是否弃置两张牌发动贯石斧，强制对<font color=0xafff7d>"+(Game.room.players[Game.room.askingParam.target].name+(Game.room.askingParam.target==Game.room.selfPlayer.seatID?"(你)":""))+"</font>造成伤害"},minCardCount:2,maxCardCount:2}),e.createCardClass({name:"GuanShiFu",tipName:"贯石斧",type:CardType.Equip,equipType:EquipType.Arm,attackRange:3,enabled:!0,tip:"装备贯石斧",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$GuanShiFu"==t?e.hasEquip("GuanShiFu"):void 0})}}),e.createSkill({name:"$FangTianHuaJi",type:SkillType.Lock,init:function(e){e.syncEvents.on(GameSyncEvent.CalcExtraMaxTargetCount,function(e,t,n){return e.hasSkill("$FangTianHuaJi")&&"Sha"==t["class"].name&&1==e.hand.length&&t==e.hand[0]?n+2:void 0})}}),e.createCardClass({name:"FangTianHuaJi",tipName:"方天画戟",type:CardType.Equip,equipType:EquipType.Arm,attackRange:4,enabled:!0,tip:"装备方天画戟",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$FangTianHuaJi"==t?e.hasEquip("FangTianHuaJi"):void 0})}}),e.createSkill({name:"$ZhuGeLianNu",type:SkillType.Lock,init:function(e){e.syncEvents.on(GameSyncEvent.LimitUseCount,function(e,t){return e.hasSkill("$ZhuGeLianNu")&&"Sha"==t["class"].name?!1:void 0})}}),e.createCardClass({name:"ZhuGeLianNu",tipName:"诸葛连弩",type:CardType.Equip,equipType:EquipType.Arm,attackRange:1,enabled:!0,tip:"装备诸葛连弩",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$ZhuGeLianNu"==t?e.hasEquip("ZhuGeLianNu"):void 0})}}),e.createAsking({name:"$QiLinGong",param:{title:function(){var e=Game.room.selfPlayer,t=Game.room.players[Game.room.askingParam.target];return"<font color=0xffd800>麒麟弓</font> <font>选择弃置一张"+(t.name+(e==t?"(你)":""))+"的马</font>"},cardCount:1}}),e.createSkill({name:"$QiLinGong",tipName:"麒麟弓",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"$QiLinGong")},tip:function(){return"您是否对<font color=0xafff7d>"+(Game.room.players[Game.room.askingParam.target].name+(Game.room.askingParam.target==Game.room.selfPlayer.seatID?"(你)":""))+"</font>使用 麒麟弓"}}),e.createCardClass({name:"QiLinGong",tipName:"麒麟弓",type:CardType.Equip,equipType:EquipType.Arm,attackRange:5,enabled:!0,tip:"装备麒麟弓",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$QiLinGong"==t?e.hasEquip("QiLinGong"):void 0})}}),e.createSkill({name:"$QingGangJian",type:SkillType.Lock}),e.createCardClass({name:"QingGangJian",tipName:"青釭剑",type:CardType.Equip,equipType:EquipType.Arm,attackRange:2,enabled:!0,tip:"装备青釭剑",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$QingGangJian"==t?e.hasEquip("QingGangJian"):void 0})}}),e.createAsking({name:"$QingLongYanYueDao",param:{tip:function(){var e=Game.room.selfPlayer,t=Game.room.players[Game.room.askingParam.targets[0]];return"是否发动青龙偃月刀继续对<font color=0xafff7d>"+(t.name+(e==t?"(你)":""))+"</font>使用杀"},cardClassName:"Sha"}}),e.createSkill({name:"$QingLongYanYueDao",tipName:"青龙偃月刀",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"$QingLongYanYueDao")},filterSelect:!0}),e.createCardClass({name:"QingLongYanYueDao",tipName:"青龙偃月刀",type:CardType.Equip,equipType:EquipType.Arm,attackRange:3,enabled:!0,tip:"装备青龙偃月刀",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$QingLongYanYueDao"==t?e.hasEquip("QingLongYanYueDao"):void 0})}}),e.createSkill({name:"$ZhangBaSheMao",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&(e.room.askingMatch(AskingType.PlayCard)&&e.cardEnabled(e.room.makeVirtualCard("Sha"))||(e.room.askingMatch(AskingType.UseCard)||e.room.askingMatch(AskingType.RespondCard))&&"Sha"==e.room.askingParam.cardClassName)},tip:"是否发动丈八蛇矛将两张手牌当杀使用或打出",minCardCount:2,maxCardCount:2,filterCard:function(e,t,n,r){return r.filter(function(e){return e.inHand})},viewAs:function(e,t,n,r,a){return t.room.makeVirtualCard("Sha",n)},init:function(e){e.require(RequireType.CardClass,"Sha")}}),e.createCardClass({name:"ZhangBaSheMao",tipName:"丈八蛇矛",type:CardType.Equip,equipType:EquipType.Arm,attackRange:3,enabled:!0,tip:"装备丈八蛇矛",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$ZhangBaSheMao"==t?e.hasEquip("ZhangBaSheMao"):void 0})}}),e.createSkill({name:"*CiXiongShuangGuJian_target",type:SkillType.Normal,tip:function(){var e=Game.room.players[Game.room.askingParam.source].name+(Game.room.askingParam.source==Game.room.selfPlayer.seatID?"(你)":"");return e+"发动雌雄双股剑，请弃置一张手牌或点取消让"+e+"摸一张牌"},maxCardCount:1,filterCard:function(e,t,n,r){return r.filter(function(e){return e.inHand})}}),e.createSkill({name:"$CiXiongShuangGuJian",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"$CiXiongShuangGuJian")},tip:function(){return"您是否对<font color=0xafff7d>"+(Game.room.players[Game.room.askingParam.target].name+(Game.room.askingParam.target==Game.room.selfPlayer.seatID?"(你)":""))+"</font>使用 雌雄双股剑"}}),e.createCardClass({name:"CiXiongShuangGuJian",tipName:"雌雄双股剑",type:CardType.Equip,equipType:EquipType.Arm,attackRange:2,enabled:!0,tip:"装备雌雄双股剑",init:function(e){e.syncEvents.on(GameSyncEvent.HasSkill,function(e,t){return"$CiXiongShuangGuJian"==t?e.hasEquip("CiXiongShuangGuJian"):void 0})}})},Package.general.std=function(){var e=Game.createPackage("std/card");e.createSkill({name:"HuangGaiKuRou",tipName:"苦肉",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.PlayCard)}}),e.createGeneral({name:"HuangGai",tipName:"黄盖",country:Country.Wu,sex:Sex.Male,HP:4,skills:["HuangGaiKuRou"]}),e.createSkill({name:"ZhangFeiPaoXiao",tipName:"咆哮",type:SkillType.Lock,init:function(e){e.syncEvents.on(GameSyncEvent.LimitUseCount,function(e,t){return e.hasSkill("ZhangFeiPaoXiao")&&"Sha"==t["class"].name?!1:void 0})}}),e.createGeneral({name:"ZhangFei",tipName:"张飞",country:Country.Shu,sex:Sex.Male,HP:4,skills:["ZhangFeiPaoXiao"]}),e.createSkill({name:"ZhenJiLuoShen",tipName:"洛神",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"ZhenJiLuoShen")}}),e.createSkill({name:"ZhenJiQingGuo",tipName:"倾国",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&(e.room.askingMatch(AskingType.UseCard)||e.room.askingMatch(AskingType.RespondCard))&&"Shan"==e.room.askingParam.cardClassName},maxCardCount:1,tip:"选择一张黑色花色的手牌当【闪】使用",filterCard:function(e,t,n,r){return r.filter(function(e){return e.inHand&&e.color==Color.Black})},viewAs:function(e,t,n,r,a){return t.room.makeVirtualCard("Shan",n)},init:function(e){e.require(RequireType.CardClass,"Shan")}}),e.createGeneral({name:"ZhenJi",tipName:"甄姬",country:Country.Wei,sex:Sex.Female,HP:3,skills:["ZhenJiLuoShen","ZhenJiQingGuo"]}),e.createSkill({name:"HuaTuoJiJiu",tipName:"急救",type:SkillType.Normal,enabled:function(e){return e.room.round.player!=e&&e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseCard)&&"Tao"==e.room.askingParam.cardClassName},maxCardCount:1,tip:"选择一张红色手牌或装备当【桃】使用",filterCard:function(e,t,n,r){return r.filter(function(e){return e.color==Color.Red})},viewAs:function(e,t,n,r,a){return t.room.makeVirtualCard("Tao",n)},init:function(e){e.require(RequireType.CardClass,"Tao")}}),e.createSkill({name:"HuaTuoQingNang",tipName:"青囊",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.PlayCard)&&e.getFlag("useHuaTuoQingNangCount")<1},maxCardCount:1,tip:"请选择弃置一张手牌，然后选择一名目标，点击确定为其回复1点体力",filterCard:function(e,t,n,r){return r.filter(function(e){return e.inHand})},filterSelect:function(e,t,n,r,a){return 1==r.length?[]:a.filter(function(e){return e.wounded})},selectCorrectly:function(e,t,n,r){return 1==r.length}}),e.createGeneral({name:"HuaTuo",tipName:"华佗",country:Country.Qun,sex:Sex.Male,HP:3,skills:["HuaTuoJiJiu","HuaTuoQingNang"]}),e.createSkill({name:"GanNingQiXi",tipName:"奇袭",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&(e.room.askingMatch(AskingType.PlayCard)&&e.cardEnabled(e.room.makeVirtualCard("GuoHeChaiQiao"))||e.room.askingMatch(AskingType.UseCard)&&"GuoHeChaiQiao"==e.room.askingParam.cardClassName)},maxCardCount:1,tip:"把一张黑色的手牌或者装备当【过河拆桥】使用",filterCard:function(e,t,n,r){return r.filter(function(e){return e.color==Color.Black})},viewAs:function(e,t,n,r,a){return t.room.makeVirtualCard("GuoHeChaiQiao",n)},init:function(e){e.require(RequireType.CardClass,"GuoHeChaiQiao")}}),e.createGeneral({name:"GanNing",tipName:"甘宁",country:Country.Wu,sex:Sex.Male,HP:4,skills:["GanNingQiXi"]}),e.createSkill({name:"GuanYuWuSheng",tipName:"武圣",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&(e.room.askingMatch(AskingType.PlayCard)&&e.cardEnabled(e.room.makeVirtualCard("Sha"))||(e.room.askingMatch(AskingType.UseCard)||e.room.askingMatch(AskingType.RespondCard))&&"Sha"==e.room.askingParam.cardClassName)},maxCardCount:1,tip:function(){return 1==UI.self.gameArea.selectedCount?"请选择要杀的目标":"选择一张红色的手牌或装备"},filterCard:function(e,t,n,r){return r.filter(function(e){return e.color==Color.Red})},viewAs:function(e,t,n,r,a){return t.room.makeVirtualCard("Sha",n)},init:function(e){e.require(RequireType.CardClass,"Sha")}}),e.createGeneral({name:"GuanYu",tipName:"关羽",country:Country.Shu,sex:Sex.Male,HP:4,skills:["GuanYuWuSheng"]}),e.createSkill({name:"LvMengKeJi",tipName:"克己",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"LvMengKeJi")}}),e.createGeneral({name:"LvMeng",tipName:"吕蒙",country:Country.Wu,sex:Sex.Male,HP:4,skills:["LvMengKeJi"]}),e.createSkill({name:"*XiaHouDunGangLie_target",type:SkillType.Normal,minCardCount:2,maxCardCount:2,filterCard:function(e,t,n,r){return r.filter(function(e){return e.inHand})},tip:function(){return"<font color=0xafff7d>"+(Game.room.players[Game.room.askingParam.player].name+(Game.room.askingParam.target==Game.room.selfPlayer.seatID?"(你)":""))+"</font>发动了“刚烈”，请选两张手牌点确定弃置，或点取消收到1点伤害"}}),e.createSkill({name:"XiaHouDunGangLie",tipName:"刚烈",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"XiaHouDunGangLie")},tip:function(){return"<font color=0xafff7d>"+(Game.room.players[Game.room.askingParam.source].name+(Game.room.askingParam.target==Game.room.selfPlayer.seatID?"(你)":""))+"</font>对你造成伤害，是否发动“刚烈”"}}),e.createGeneral({name:"XiaHouDun",tipName:"夏侯惇",country:Country.Wei,sex:Sex.Male,HP:4,skills:["XiaHouDunGangLie"]}),e.createSkill({name:"MaChaoMaShu",tipName:"马术",type:SkillType.Lock,init:function(e){e.syncEvents.on(GameSyncEvent.CalcDistance,function(e,t,n){return e.hasSkill("MaChaoMaShu")?n-1:void 0})}}),e.createSkill({name:"MaChaoTieQi",tipName:"铁骑",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"MaChaoTieQi")},tip:function(){return"您是否对<font color=0xafff7d>"+(Game.room.players[Game.room.askingParam.target].name+(Game.room.askingParam.target==Game.room.selfPlayer.seatID?"(你)":""))+"</font>使用 铁骑"},init:function(e){e.syncEvents.on(GameSyncEvent.CanAnswerCard,function(e,t,n){return"Shan"==n&&t.cardID==e.getFlag("MaChaoTieQiEffect")?!1:void 0})}}),e.createGeneral({name:"MaChao",tipName:"马超",country:Country.Shu,sex:Sex.Male,HP:4,skills:["MaChaoMaShu","MaChaoTieQi"]}),e.createSkill({name:"ZhaoYunLongDan",tipName:"龙胆",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&(e.room.askingMatch(AskingType.PlayCard)&&e.cardEnabled(e.room.makeVirtualCard("Sha"))||(e.room.askingMatch(AskingType.UseCard)||e.room.askingMatch(AskingType.RespondCard))&&("Sha"==e.room.askingParam.cardClassName||"Shan"==e.room.askingParam.cardClassName))},maxCardCount:1,tip:function(){return"选择一张杀或闪"},filterCard:function(e,t,n,r){return t.room.askPlayers.includes(t)&&t.room.askingType==AskingType.PlayCard||"Sha"==t.room.askingParam.cardClassName?r.filter(function(e){return"Shan"==e["class"].name}):r.filter(function(e){return"Sha"==e["class"].name})},viewAs:function(e,t,n,r,a){return"Sha"==n[0]["class"].name?t.room.makeVirtualCard("Shan",n):"Shan"==n[0]["class"].name?t.room.makeVirtualCard("Sha",n):void 0}}),e.createGeneral({name:"ZhaoYun",tipName:"赵云",country:Country.Shu,sex:Sex.Male,HP:4,skills:["ZhaoYunLongDan"]}),e.createSkill({name:"ZhouYuYingZi",tipName:"英姿",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"ZhouYuYingZi")}}),e.createAsking({name:"ZhouYuFanJian",param:{tip:function(){var e=Game.room.players[Game.room.askingParam.target];return"<font color=0xafff7d>"+e.name+"</font>对你发动了“反间”，请选择一种花色"}}}),e.createSkill({name:"ZhouYuFanJian",tipName:"反间",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.PlayCard)&&e.getFlag("useZhouYuFanJianCount")<1&&e.hand.length>0},filterSelect:function(e,t,n,r,a){return 1==r.length?[]:a.filter(function(e){return e!=t})},selectCorrectly:function(e,t,n,r){return 1==r.length}}),e.createGeneral({name:"ZhouYu",tipName:"周瑜",country:Country.Wu,sex:Sex.Male,HP:3,skills:["ZhouYuYingZi","ZhouYuFanJian"]}),e.createSkill({name:"LiuBeiRenDe",tipName:"仁德",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.PlayCard)},maxCardCount:1/0,filterCard:function(e,t,n,r){return r.filter(function(e){return e.inHand})},filterSelect:function(e,t,n,r,a){return 1==r.length?[]:a.filter(function(e){return e!=t})},selectCorrectly:function(e,t,n,r){return 1==r.length}}),e.createAsking({name:"LiuBeiJiJiang",param:{cardClassName:"Sha",tip:function(){var e=Game.room.players[Game.room.askingParam.source],t="<font color=0xafff7d>"+e.name+"</font>";return t+"动激将，请你替"+t+"打出【杀】"}}}),e.createSkill({name:"LiuBeiJiJiang",tipName:"激将",emperor:!0,type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&(e.room.askingMatch(AskingType.PlayCard)&&e.cardEnabled(e.room.makeVirtualCard("Sha"))||(e.room.askingMatch(AskingType.UseCard)||e.room.askingMatch(AskingType.RespondCard))&&"Sha"==e.room.askingParam.cardClassName)},tip:"选择你要杀的角色，点击确定发动，其他蜀国武将可以替你出杀",viewAs:function(e,t,n,r,a){return t.room.makeVirtualCard("Sha")},init:function(e){e.require(RequireType.CardClass,"Sha")}}),e.createGeneral({name:"LiuBei",tipName:"刘备",country:Country.Shu,sex:Sex.Male,HP:4,skills:["LiuBeiRenDe","LiuBeiJiJiang"]}),e.createSkill({name:"SunQuanZhiHeng",tipName:"制衡",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.PlayCard)&&e.getFlag("useSunQuanZhiHengCount")<1},maxCardCount:1/0,tip:'请选择你要"制衡"的手牌或者装备牌',filterCard:!0}),e.createSkill({name:"SunQuanJiuYuan",tipName:"救援",emperor:!0,type:SkillType.Lock}),e.createGeneral({name:"SunQuan",tipName:"孙权",country:Country.Wu,sex:Sex.Male,HP:4,skills:["SunQuanZhiHeng","SunQuanJiuYuan"]}),e.createSkill({name:"CaoCaoJianXiong",tipName:"奸雄",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"CaoCaoJianXiong")}}),e.createAsking({name:"CaoCaoHuJia",param:{cardClassName:"Shan",tip:function(){var e=Game.room.players[Game.room.askingParam.source];return"你是否帮<font color=0xafff7d>"+e.name+"</font>护驾"}}}),e.createSkill({name:"CaoCaoHuJia",tipName:"护驾",emperor:!0,type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&(e.room.askingMatch(AskingType.UseCard)||e.room.askingMatch(AskingType.RespondCard))&&"Shan"==e.room.askingParam.cardClassName},viewAs:function(e,t,n,r,a){return t.room.makeVirtualCard("Shan")}}),e.createGeneral({name:"CaoCao",tipName:"曹操",country:Country.Wei,sex:Sex.Male,HP:4,skills:["CaoCaoJianXiong","CaoCaoHuJia"]}),e.createSkill({name:"DaQiaoGuoSe",tipName:"国色",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&(e.room.askingMatch(AskingType.PlayCard)&&e.cardEnabled(e.room.makeVirtualCard("LeBuSiShu"))||e.room.askingMatch(AskingType.UseCard)&&"LeBuSiShu"==e.room.askingParam.cardClassName)},maxCardCount:1,filterCard:function(e,t,n,r){return r.filter(function(e){return e.suit==Suit.Diamond})},tip:"选择一张方块牌当【乐不思蜀】，并选择一名目标",viewAs:function(e,t,n,r,a){return t.room.makeVirtualCard("LeBuSiShu",n)},init:function(e){e.require(RequireType.CardClass,"LeBuSiShu")}}),e.createSkill({name:"DaQiaoLiuLi",tipName:"流离",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"DaQiaoLiuLi")},maxCardCount:1,filterCard:!0,tip:function(){var e=Game.room.players[Game.room.askingParam.source];return"选择一张牌，并选择一名角色将<font color=0xafff7d>"+e.name+"</font>对你的杀转移给该角色"},filterSelect:function(e,t,n,r,a){if(1==r.length)return[];var i=t.room.players[t.room.askingParam.source];return a.filter(function(e){return e!=t&&e.inAttackRange(t)&&e!=i})},selectCorrectly:function(e,t,n,r){return 1==r.length}}),e.createGeneral({name:"DaQiao",tipName:"大乔",country:Country.Wu,sex:Sex.Female,HP:3,skills:["DaQiaoGuoSe","DaQiaoLiuLi"]}),e.createSkill({name:"SunShangXiangJieYin",tipName:"结姻",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.PlayCard)&&e.getFlag("useSunShangXiangJieYinCount")<1},minCardCount:2,maxCardCount:2,filterCard:function(e,t,n,r){return r.filter(function(e){return e.inHand})},tip:"选择两张要弃置的手牌，并选择一名已受伤的男性为目标",filterSelect:function(e,t,n,r,a){return 1==r.length?[]:a.filter(function(e){return e.wounded&&e.sex==Sex.Male})},selectCorrectly:function(e,t,n,r){return 1==r.length}}),e.createSkill({name:"SunShangXiangXiaoJi",tipName:"枭姬",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"SunShangXiangXiaoJi")}}),e.createGeneral({name:"SunShangXiang",tipName:"孙尚香",country:Country.Wu,sex:Sex.Female,HP:3,skills:["SunShangXiangJieYin","SunShangXiangXiaoJi"]}),e.createSkill({name:"DiaoChanLiJian",tipName:"离间",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.PlayCard)&&e.getFlag("useDiaoChanLiJianCount")<1},maxCardCount:1,filterCard:!0,tip:"选择一张牌，并选择两名男性角色为目标",filterSelect:function(e,t,n,r,a){return 2==r.length?[]:a.filter(function(e){return e.sex==Sex.Male&&!r.includes(e)})},selectCorrectly:function(e,t,n,r){return 2==r.length},showTargetLines:function(e,t,n){n(e,t[1]),n(t[1],t[0],1)}}),e.createSkill({name:"DiaoChanBiYue",tipName:"闭月",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"DiaoChanBiYue")}}),e.createGeneral({name:"DiaoChan",tipName:"貂蝉",country:Country.Qun,sex:Sex.Female,HP:3,skills:["DiaoChanLiJian","DiaoChanBiYue"]}),e.createSkill({name:"ZhangLiaoTuXi",tipName:"突袭",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"ZhangLiaoTuXi")},tip:"选择1至2名角色为目标，从他们的手牌里各抽取一张牌",filterSelect:function(e,t,n,r,a){return 2==r.length?[]:a.filter(function(e){return e!=t&&e.hand.length})},selectCorrectly:function(e,t,n,r){return 1==r.length||2==r.length}}),e.createGeneral({name:"ZhangLiao",tipName:"张辽",country:Country.Wei,sex:Sex.Male,HP:4,skills:["ZhangLiaoTuXi"]}),e.createSkill({name:"XuChuLuoYi",tipName:"裸衣",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"XuChuLuoYi")}}),e.createGeneral({name:"XuChu",tipName:"许褚",country:Country.Wei,sex:Sex.Male,HP:4,skills:["XuChuLuoYi"]}),e.createSkill({name:"HuangYueYingJiZhi",tipName:"集智",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"HuangYueYingJiZhi")}}),e.createSkill({name:"HuangYueYingQiCai",tipName:"奇才",type:SkillType.Lock,init:function(e){e.syncEvents.on(GameSyncEvent.LimitUseCount,function(e,t){return e.hasSkill("HuangYueYingQiCai")&&t["class"].type==CardType.Bag?!1:void 0})}}),e.createGeneral({name:"HuangYueYing",tipName:"黄月英",country:Country.Shu,sex:Sex.Female,HP:3,skills:["HuangYueYingJiZhi","HuangYueYingQiCai"]})},Package.general.wind=function(){var e=Game.createPackage("wind");e.createSkill({name:"CaoRenJuShou",tipName:"据守",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"CaoRenJuShou")}}),e.createGeneral({name:"CaoRen",tipName:"曹仁",country:Country.Wei,sex:Sex.Male,HP:4,skills:["CaoRenJuShou"]}),e.createSkill({name:"HuangZhongLieGong",tipName:"烈弓",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"HuangZhongLieGong")}}),e.createGeneral({name:"HuangZhong",tipName:"黄忠",country:Country.Shu,sex:Sex.Male,HP:4,skills:["HuangZhongLieGong"]}),e.createSkill({name:"WeiYanKuangGu",tipName:"狂骨",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"WeiYanKuangGu")}}),e.createGeneral({name:"WeiYan",tipName:"魏延",country:Country.Shu,sex:Sex.Male,HP:4,skills:["WeiYanKuangGu"]}),e.createSkill({name:"XiaHouYuanShenSu",tipName:"神速",type:SkillType.Normal,enabled:function(e){return e.room.askPlayers.includes(e)&&e.room.askingMatch(AskingType.UseSkill,"XiaHouYuanShenSu")},minCardCount:0,maxCardCount:1,filterCard:function(e,t,n,r){var a=t.room.askingParam.phase;return a==Phase.Judge?[]:r.filter(function(e){return e["class"].type==CardType.Equip})},filterSelect:function(e,t,n,r,a){return r.length==1+t.extraMaxTargetCount(t.room.makeVirtualCard("Sha"))?[]:a.filter(function(e){return e!=t})},selectCorrectly:function(e,t,n,r){if(0==r.length)return!1;var a=t.room.askingParam.phase;return a==Phase.Judge?!0:1==n.length}}),e.createGeneral({name:"XiaHouYuan",tipName:"夏侯渊",country:Country.Wei,sex:Sex.Male,HP:4,skills:["XiaHouYuanShenSu"]})},Package.modes.AbstractIdentityMode=function(){Game.createMode({name:"AbstractIdentityMode","abstract":!0,init:function(e){}})},Package.modes.IdentityMode=function(){Game.createMode({name:"IdentityMode","abstract":!0,init:function(e){e.require(RequireType.Mode,"AbstractIdentityMode"),e.identitiesGuess=[Identity.FanZei,Identity.ZhongChen,Identity.NeiJian]}})},Package.modes.StandardIdentityMode=function(){Game.createMode({name:"StandardIdentityMode",init:function(e){e.require([{type:RequireType.Mode,name:"IdentityMode"},{type:RequireType.Package,name:"std/card"},{type:RequireType.Package,name:"ex"},{type:RequireType.Package,name:"std/general"},{type:RequireType.Package,name:"wind"}]);for(var t=1;108>=t;t++)e.cardIDs.add(t)}})};var Sound=function(){function e(){}return e.link=function(e){var t=RES.getRes("SoundLink_json");return t[e]||e},e.hasSound=function(t){return RES.hasRes(e.link(t)+"_mp3")},e.getSound=function(t){return RES.getRes(e.link(t)+"_mp3")},e.playBGM=function(){e.bgm||(e.bgm=e.getSound("bgm")),e.bgm_channel=e.bgm.play(),e.bgm_channel.volume=.5},e.stopBGM=function(){e.bgm_channel&&e.bgm_channel.stop()},e.playSound=function(t){if(!e.sounds[t]){if(!e.hasSound(t))return;e.sounds[t]={sound:e.getSound(t)}}e.sounds[t].channel=e.sounds[t].sound.play(0,1)},e.stopSound=function(t){e.sounds[t].channel&&e.sounds[t].channel.stop()},e.playCardSound=function(t,n){e.playSound(Game.getSexName(t)+"_"+n)},e.stopCardSound=function(t,n){e.stopSound(Game.getSexName(t)+"_"+n)},e.playSkillSound=function(t){var n="Skill_"+t;if(!e.sounds[n]&&!e.hasSound(n)){var r=void 0;for(r=0;n="Skill_"+t+"_"+(r+1),e.hasSound(n);r++);r>0&&(e.sounds[n]=r)}if("number"==typeof e.sounds[n]){var a=Util.random(1,e.sounds[n]);n="Skill_"+t+"_"+a}e.playSound(n)},e.stopSkillSound=function(t){var n="Skill_"+t;if("number"==typeof e.sounds[n])for(var r=1;r<=e.sounds[n];r++)e.stopSound("Skill_"+t+"_"+r);else e.stopSound(n)},e.playDeadSound=function(t){e.playSound(t.name+"_Dead")},e.stopDeadSound=function(t){e.stopSound(t.name+"_Dead")},e.sounds={},e}();__reflect(Sound.prototype,"Sound");var CardCountLabel=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"country",{set:function(e){this.img_bg.source=Game.getCountryName(e)+"CardCountBG"},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(CardCountLabel.prototype,"CardCountLabel");var CardRenderer=function(e){function t(){var t=e.call(this)||this;return t.fixed=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddedToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemovedFromStage,t),t.skinName="CardRendererSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"dark",{get:function(){return this.img_dark.alpha},set:function(e){this.img_dark.alpha=e},enumerable:!0,configurable:!0}),t.prototype.dataChanged=function(){this.enabled=!this.data.disabled,this.enabled||(this.img_class.filters=[])},t.prototype.onAddedToStage=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopMove,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.releaseOutside,this)},t.prototype.startMove=function(e){this.img_class.filters=this.enabled?[GlowFilter.mouseover]:[]},t.prototype.stopMove=function(e){var t=!this.selected;this.refreshStyle(t)},t.prototype.releaseOutside=function(e){this.refreshStyle()},t.prototype.onRemovedFromStage=function(){this.touchEnabled=!1,this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.stopMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.releaseOutside,this)},t.prototype.refreshStyle=function(e){if("undefined"==typeof e&&(e=this.selected),this.img_class.filters=this.enabled&&e?[GlowFilter.mouseover]:[],!this.fixed){var t=e?-10:0;egret.Tween.removeTweens(this.group),egret.Tween.get(this.group).to({y:t},100)}},t}(eui.ItemRenderer);__reflect(CardRenderer.prototype,"CardRenderer");var FixedCardRenderer=function(e){function t(){var t=e.call(this)||this;return t.fixed=!0,t}return __extends(t,e),t}(CardRenderer);__reflect(FixedCardRenderer.prototype,"FixedCardRenderer");var CardRendererWithBack=function(e){function t(t){var n=e.call(this)||this;return n.rotate=!0,n.addEventListener(egret.Event.ADDED_TO_STAGE,function(){n.touchChildren=!0,n.front=new CardRenderer,n.front.data=t,n.addChild(n.front),n.back=new CardRenderer,n.back.data=Game.makeCardUIData(Game.room.unknownCard),n.addChild(n.back),n.width=n.front.width,n.height=n.front.height},n),n}return __extends(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this.front.data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"img_dark",{get:function(){return this.front.img_dark},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frontScaleX",{get:function(){return this.front.scaleX},set:function(e){this.front.scaleX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frontSbackScaleXcaleX",{get:function(){return this.back.scaleX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backScaleX",{set:function(e){this.back.scaleX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dark",{get:function(){return this.img_dark.alpha
},set:function(e){this.img_dark.alpha=e},enumerable:!0,configurable:!0}),t}(egret.DisplayObjectContainer);__reflect(CardRendererWithBack.prototype,"CardRendererWithBack");var CardSelectorWindow=function(e){function t(t){var n=e.call(this,t.title)||this;n.cardLabelUI=[],n.cardCount=t.cardCount,n.hand=t.hand,n.equip=t.equip,n.judge=t.judge;var r=0;return n.hand.length&&r++,n.equip.length&&r++,n.judge.length&&r++,n.height=46+88*r,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.hand.length&&this.createCardLabel(Zone.Hand,"手牌",this.hand),this.equip.length&&this.createCardLabel(Zone.Equip,"装备",this.equip),this.judge.length&&this.createCardLabel(Zone.Judge,"延时锦囊",this.judge)},t.prototype.createCardLabel=function(e,t,n){var r=this,a=88*this.cardLabelUI.length,i=[new eui.Group,new eui.Image,new eui.Label,new eui.Scroller,new eui.List],o=i[0],s=i[1],l=i[2],u=i[3],c=i[4];o.y=a,o.percentWidth=100,o.height=84,s.left=0,s.verticalCenter=0,s.width=14,s.height=60,s.source="WindowCardLabelBG_png",o.addChild(s),l.text=t,l.x=2,l.verticalCenter=0,l.width=10,l.height=50,l.size=10,l.verticalAlign="middle",l.textAlign="middle",l.fontFamily="Microsoft YaHei",l.textColor=14996896,o.addChild(l),u.left=24,u.right=0,u.height=84,u.scrollPolicyH="auto",u.scrollPolicyV="off",u.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){r.enableDrog=!1},this),u.addEventListener(egret.TouchEvent.TOUCH_END,function(){r.enableDrog=!0},this),u.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){r.enableDrog=!0},this),c.allowMultipleSelection=!0,c.itemRenderer=FixedCardRenderer,c.useVirtualLayout=!1;var d=new eui.HorizontalLayout;d.gap=0,d.paddingLeft=2,d.paddingTop=1,d.paddingBottom=1,c.layout=d;var p=n.map(function(e){var t=Game.makeCardUIData(e);return t.disabled=!1,t});c.dataProvider=new eui.ArrayCollection(p),c.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onChange,this),u.viewport=c,o.addChild(u),this.cardLabelUI.push({zone:e,group:o,img:s,label:l,scroller:u,list:c}),this.body.addChild(o)},Object.defineProperty(t.prototype,"selectedCount",{get:function(){var e=0;return this.cardLabelUI.forEach(function(t){e+=t.list.selectedItems.length}),e},enumerable:!0,configurable:!0}),t.prototype.onChange=function(){var e=this;if(this.selectedCount==this.cardCount){var t=[],n=[];this.cardLabelUI.forEach(function(r){r.list.selectedItems.every(function(a,i){return t.push(a.cardID),r.zone==Zone.Judge&&e.judge[r.list.selectedIndices[i]].virtual&&n.push(e.judge[r.list.selectedIndices[i]]["class"].name),!0})}),Game.socket.emit("select cards",{cardIDs:t,classNames:n}),Game.room.selfPlayer.endAsk(),this.exit()}},t}(GameWindow);__reflect(CardSelectorWindow.prototype,"CardSelectorWindow");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function a(e){t.call(r,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(r))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var EffectPosition;!function(e){e[e.Middle=0]="Middle",e[e.Right=1]="Right",e[e.General=2]="General"}(EffectPosition||(EffectPosition={}));var GameSidebarArea=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(eui.Component);__reflect(GameSidebarArea.prototype,"GameSidebarArea");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?r(a):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GlobalCardSelectorWindow=function(e){function t(t,n){var r=e.call(this,t)||this;r._canSelect=!1,r.cardsUI=[],r.cards=n;var a=n.length>4?2:1,i=n.length>4?4:n.length;r.height=46+88*a;var o=30+68*i;return 220>o&&(o=220),r.width=o,UI.sceneGame.globalCardSelectorWindow=r,r}return __extends(t,e),t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this);var n,r=0,a=0;this.cards.every(function(e,i){n||(n=new eui.Group,n.y=a,n.horizontalCenter=0,n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.enableDrog=!1},t),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.enableDrog=!0},t),n.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.enableDrog=!0},t),t.body.addChild(n));var o=new FixedCardRenderer;o.x=r,o.y=0;var s=Game.makeCardUIData(e);return s.disabled=!0,o.data=s,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onSelected(o)},t),t.cardsUI.push(o),n.addChild(o),i%4==3?(r=0,a+=o.height+3,n=void 0):r+=o.width,!0})},Object.defineProperty(t.prototype,"canSelect",{get:function(){return this._canSelect},set:function(e){this._canSelect=e,this.cardsUI.forEach(function(t){var n=t.data;n.disabled=!e||n.dark,t.data=n})},enumerable:!0,configurable:!0}),t.prototype.dark=function(e){this.cardsUI.forEach(function(t){if(t.data.cardID==e){var n=t.data;n.dark=!0,t.data=n}})},t.prototype.onSelected=function(e){this.canSelect&&(e.data.dark||(Game.socket.emit("select card",e.data.cardID),this.canSelect=!1,Game.room.selfPlayer.endAsk()))},t.prototype.exit=function(){e.prototype.exit.call(this),UI.sceneGame.globalCardSelectorWindow=void 0},t}(GameWindow);__reflect(GlobalCardSelectorWindow.prototype,"GlobalCardSelectorWindow");var IdentityButton=function(e){function t(){var t=e.call(this)||this;return t._identity=Identity.Unknown,t.hide=!1,t.showingList=!1,t.once(egret.Event.COMPLETE,t.onComplete,t),t}return __extends(t,e),t.prototype.onComplete=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},t.getIdentityPicName=function(e){return"Identity_"+Game.getIdentityName(e)+"_png"},Object.defineProperty(t.prototype,"identity",{get:function(){return this._identity},set:function(e){this._identity=e,this.showIdentity()},enumerable:!0,configurable:!0}),t.prototype.showIdentity=function(){this.hide=!1,this.img_identity.source=t.getIdentityPicName(this.identity)},t.prototype.hideIdentity=function(){this.hide=!0,this.img_identity.source=t.getIdentityPicName(Identity.Unknown)},t.prototype.setIdentityVisible=function(e){e?this.showIdentity():this.hideIdentity()},t.prototype.showList=function(){this.showingList=!0,this.buttonList=[];for(var e=this,n=e.x,r=e.y,a=e.height,i=0,o=Game.room.identitiesGuess;i<o.length;i++){var s=o[i];r=r+a+5;var l=new t;l.skinName="IdentityButtonSkin",l.hostButton=this,l.identity=s,u=[n,r],l.x=u[0],l.y=u[1],this.parent.addChild(l),this.buttonList.push(l)}var u},t.prototype.removeList=function(){var e=this;this.showingList=!1,this.buttonList.forEach(function(t){e.parent.removeChild(t)}),this.buttonList=[]},t.prototype.setListExistent=function(e){e?this.showList():this.removeList()},t.prototype.guessIdentity=function(e){this.img_identity.source=t.getIdentityPicName(e)},t.prototype.onClick=function(){this.hostButton?(this.hostButton.identity==Identity.Unknown&&this.hostButton.guessIdentity(this.identity),this.hostButton.removeList()):this.identity==Identity.Unknown?(this.guessIdentity(Identity.Unknown),this.setListExistent(!this.showingList)):this.setIdentityVisible(this.hide)},t}(eui.Component);__reflect(IdentityButton.prototype,"IdentityButton");var JudgeZoneFlag=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(eui.Image);__reflect(JudgeZoneFlag.prototype,"JudgeZoneFlag");var OperationArea=function(e){function t(){var t=e.call(this)||this;return t.btnMap={ok:function(){return t.btn_ok},cancel:function(){return t.btn_cancel},over:function(){return t.btn_over},heart:function(){return t.btn_heart},diamond:function(){return t.btn_diamond},spade:function(){return t.btn_spade},club:function(){return t.btn_club}},t.defaultBtnStatus={ok:{visible:function(){return!1}},cancel:{visible:function(){return!1}},over:{visible:function(){return!1}},heart:{visible:function(){return!1}},diamond:{visible:function(){return!1}},spade:{visible:function(){return!1}},club:{visible:function(){return!1}}},t.addEventListener(egret.Event.COMPLETE,t.onComplete,t),t}return __extends(t,e),t.prototype.onComplete=function(){var e=this;this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOk,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this),this.btn_over.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOver,this),this.btn_heart.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return e.onSuit("heart")},this),this.btn_diamond.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return e.onSuit("diamond")},this),this.btn_spade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return e.onSuit("spade")},this),this.btn_club.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return e.onSuit("club")},this)},Object.defineProperty(t.prototype,"buttonStatus",{get:function(){return Game.room&&Game.room.askingParam&&Game.room.askingParam.btnStatus||this.defaultBtnStatus},enumerable:!0,configurable:!0}),t.prototype.onOk=function(){var e=this.buttonStatus;e.ok&&e.ok.onClick&&e.ok.onClick()},t.prototype.onCancel=function(){var e=this.buttonStatus;e.cancel&&e.cancel.onClick?e.cancel.onClick():UI.self.gameArea.cancelSelection()},t.prototype.onOver=function(){var e=this.buttonStatus;e.over&&e.over.onClick&&e.over.onClick()},t.prototype.onSuit=function(e){var t=this.buttonStatus;t[e]&&t[e].onClick&&t[e].onClick()},t.prototype.refreshButtonStatus=function(){var e=this,t=this.buttonStatus;Object.keys(t).forEach(function(n){var r=e.btnMap[n]();t[n].visible&&(r.visible=t[n].visible()),t[n].enabled&&(r.enabled=t[n].enabled())})},t}(eui.Component);__reflect(OperationArea.prototype,"OperationArea");var OthersEquip=function(e){function t(){var t=e.call(this)||this;return t.skinName="OthersEquipSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"equip",{set:function(e){var t=Game.getColorName(Game.getColor(e.suit));this.img_equip.source="Others"+e["class"].name+"_png",this.img_suit.source=Game.getSuitName(e.suit).toLowerCase(),this.img_number.source=t+"CardNumber_"+e.number},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(OthersEquip.prototype,"OthersEquip");var OthersGameArea=function(e){function t(){var t=e.call(this)||this;return t.generalAreas=[],t.once(egret.Event.COMPLETE,t.onComplete,t),t}return __extends(t,e),t.prototype.initGeneralAreas=function(e){this.generalAreas.forEach(function(e){UI.others.gameArea.removeChild(e)}),this.generalAreas=[];for(var t=0;e-1>t;t++){var n=new OthersGeneralArea;n.skinName="OthersGeneralAreaSkin",this.generalAreas.push(n),2==e?0==t&&(n.y=16,n.horizontalCenter=0):8==e&&(0==t?(n.y=246,n.horizontalCenter=381.5):1==t?(n.y=87,n.horizontalCenter=381.5):2==t?(n.y=16,n.horizontalCenter=196.5):3==t?(n.y=16,n.horizontalCenter=0):4==t?(n.y=16,n.x=205):5==t?(n.y=87,n.x=21):6==t&&(n.y=246,n.x=21)),this.addChild(n)}},t.prototype.onComplete=function(){this.group_hidden.visible=!1},t}(eui.Component);__reflect(OthersGameArea.prototype,"OthersGameArea");var OthersGeneralArea=function(e){function t(){var t=e.call(this)||this;return t.judgeZoneUI=[],t.once(egret.Event.COMPLETE,t.onComplete,t),t}return __extends(t,e),t.prototype.onComplete=function(){this.img_phase.source="",this.img_seatNum.source="",this.lb_generalName.filters=[GlowFilter.generalNameGlow]},Object.defineProperty(t.prototype,"equipUI",{get:function(){return[this.equipUI0,this.equipUI1,this.equipUI2,this.equipUI3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"country",{set:function(e){this.cardCountLabel.country=e,this.img_country.source=Game.getCountryName(e).toUpperCase()+"_png",this.img_generalNameBG.source=Game.getCountryName(e)+"BG"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"seatNum",{set:function(e){var t="Seat"+e+"_png";this.img_seatNum.source=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"identity",{set:function(e){this._identity=e,this.btn_identity.identity=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alive",{set:function(e){if(this.img_general.filters=e?[]:[ColorFilter.gray],e)this.img_deadFlag.visible=!1;else{var t=Game.getIdentityName(this._identity)+"Dead_png";RES.hasRes(t)||(t=""),this.img_deadFlag.source=t,this.img_deadFlag.visible=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"general",{set:function(e){this.img_general.source=e.name+"_png"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{set:function(e){this.lb_generalName.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentToSelect",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"helpMe",{set:function(e){this.img_helpMe.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"back",{set:function(e){this.img_backSideState.visible=e},enumerable:!0,configurable:!0}),t.getJudgeZoneCardPicName=function(e){return"Small"+e+"_png"},t.prototype.addToJudgeZoneUI=function(e){var n=new JudgeZoneFlag;n.width=25,n.height=25,n.right=108,n.y=114,n.source=t.getJudgeZoneCardPicName(e),this.addChild(n),this.judgeZoneUI.push(n),this.refreshJudgeZoneUI()},t.prototype.removeFromJudgeZoneUI=function(e){for(var n=t.getJudgeZoneCardPicName(e),r=0;r<this.judgeZoneUI.length;r++)this.judgeZoneUI[r].source==n&&(this.removeChild(this.judgeZoneUI[r]),this.judgeZoneUI.splice(r,1),r--);this.refreshJudgeZoneUI()},t.prototype.refreshJudgeZoneUI=function(){var e=(this.judgeZoneUI.length,2);this.judgeZoneUI.every(function(t,n){var r=13+n*(t.width+e);return t.toRight&&t.toRight==r||(t.toRight=r,egret.Tween.removeTweens(t),egret.Tween.get(t).to({right:r},300)),!0})},t.prototype.playEffect=function(e){var t=this;e.x=this.width/2,e.y=this.height/2,this.addChild(e),e.gotoAndPlay(1,1),e.addEventListener(egret.Event.COMPLETE,function(){return t.removeChild(e)},this)},t}(eui.Component);__reflect(OthersGeneralArea.prototype,"OthersGeneralArea");var OthersHPArea=function(e){function t(){var t=e.call(this)||this;return t._maxHP=0,t._HP=0,t.HPColor=[[1],[3,1],[3,2,1],[3,2,1,1],[3,2,2,1,1]],t}return __extends(t,e),Object.defineProperty(t.prototype,"maxHP",{get:function(){return this._maxHP},set:function(e){this._maxHP=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HP",{get:function(){return this._HP},set:function(e){this._HP=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HPComponents",{get:function(){if(!this.group_HP)return null;for(var e=[],t=0;5>t;t++)e.push(this.group_HP.getChildAt(t));return e},enumerable:!0,configurable:!0}),t.prototype.refresh=function(){var e=this,t=this.HPComponents;if(t){var n=this.maxHP>0?this.HPColor[this.maxHP-1]:null,r=n&&this.HP>0?n[this.HP-1]:0,a="";1==r?a="GreenHPSmall":2==r?a="OrangeHPSmall":3==r&&(a="RedHPSmall"),t.every(function(t,n){var r=n+1;if(e.maxHP<r)return t.visible=!1,!0;t.visible=!0;var i=r<=e.HP;return i?t.source=a:t.source="BlackHPSmall",t.bottom=2+12*n,!0}),this.height=2+12*this.maxHP+2}},t.prototype.playLoseHPEffect=function(e,t,n){for(var r=this,a=function(e){var t=n.splice(0,1)[0];t.x=i.width/2,t.y=i.height-2-12*e,i.addChild(t),t.gotoAndPlay(1,1),t.addEventListener(egret.Event.COMPLETE,function(){return r.removeChild(t)},i)},i=this,o=t;e>o;o++)a(o)},t}(eui.Component);__reflect(OthersHPArea.prototype,"OthersHPArea");var SceneGame=function(e){function t(){var t=e.call(this)||this;return t.disposeZoneUI=[],t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onComplete,t),t.skinName="SceneGameSkin",t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onComplete=function(){this.lb_tip.filters=[GlowFilter.tipBorderGlow],Sound.playBGM(),Game.init()},t.prototype.clearPlayerSelect=function(){Game.room.players.forEach(function(e){e.dark=!1,e.cannotSelect=!0,e.selected=!1}),Game.room.selectedPlayers=[]},Object.defineProperty(t.prototype,"filterSelect",{get:function(){return Game.room&&Game.room.askingParam&&Game.room.askingParam.filterSelect},enumerable:!0,configurable:!0}),t.prototype.refreshPlayerSelect=function(){var e,t=UI.self.gameArea.selectedCards,n=Game.room.selectedPlayers,r=Game.room.alivePlayers.filter(function(e){return n.every(function(t){return t!=e})}),a=this.filterSelect;if("function"==typeof a)e=a(t,Game.room.selfPlayer,n,r);else{if("boolean"!=typeof a)return;e=!1}e===!1?Game.room.players.forEach(function(e){e.dark=!1,e.cannotSelect=!0}):Game.room.players.forEach(function(t){e.includes(t)||t.selected?(t.dark=!1,t.cannotSelect=!1):(t.dark=t.alive,t.cannotSelect=!0)})},t.prototype.refreshDisposeZoneUI=function(){var e,t,n,r,a,i=this.disposeZoneUI.length,o=6,s=229;this.disposeZoneUI.slice().reverse().every(function(l,u){if(e=e||l.width,t=t||e+o,462>=i*t)r=r||i*t-o,a=a||471-r/2,n=a+u*t;else{var c=(462-e)/(i-1);n=240+u*c}if(!l.toPoint||l.toPoint.x!=n||l.toPoint.y!=s)if(l.toPoint={x:n,y:s},l instanceof CardRendererWithBack&&l.rotate)l.x=l.toPoint.x,l.y=l.toPoint.y,l.back.scaleX=1,l.front.scaleX=0,egret.Tween.get(l).to({backScaleX:0},300).to({frontScaleX:1},300),l.rotate=!1;else if(l.tw_moving){var d=l.tw_moving;l.tw_moving=l.tw_moving.call(function(){return l.tw_moving=d}).to(l.toPoint,100).call(function(){return l.tw_moving=void 0})}else l.tw_moving=egret.Tween.get(l).to(l.toPoint,300).call(function(){return l.tw_moving=void 0});return!0})},t.prototype.disappearFromDisposeZoneUI=function(e){var t=this;e.forEach(function(e){for(var n=function(n){n.data.cardID==e&&(n.tw_disappearing||(n.data.dark=!0,n.dark=0,n.tw_disappearing=egret.Tween.get(n),n.tw_disappearing.wait(1e3).to({dark:.8},800),n.tw_disappearing.wait(1e3).to({alpha:0},1e3),n.tw_disappearing.call(function(){n.tw_disappearing=void 0,egret.Tween.removeTweens(n),t.group_movingCards.contains(n)&&t.group_movingCards.removeChild(n);var e=t.disposeZoneUI.indexOf(n);t.disposeZoneUI.splice(e,1),t.refreshDisposeZoneUI()})))},r=0,a=t.disposeZoneUI;r<a.length;r++){var i=a[r];n(i)}})},Object.defineProperty(t.prototype,"tip",{get:function(){return this.lb_tip.text},set:function(e){this.lb_tip.textFlow=(new egret.HtmlTextParser).parser(e),this.lb_tip.visible=!!e},enumerable:!0,configurable:!0}),t.prototype.refreshTip=function(){var e=Game.room.askingParam&&Game.room.askingParam.tip;this.tip=e?e():""},t}(eui.Component);__reflect(SceneGame.prototype,"SceneGame");var SelfEquip=function(e){function t(){var t=e.call(this)||this;return t.selectedBorderShowing=!1,t._canSelect=!1,t._selected=!1,t.mouseover=!1,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),this.skinName="SelfEquipSkin"},Object.defineProperty(t.prototype,"equip",{set:function(e){var t=Game.getColorName(Game.getColor(e.suit));this.img_equip.source="Self"+e["class"].name+"_png",this.img_suit.source=Game.getSuitName(e.suit).toLowerCase(),this.img_number.source=t+"CardNumber_"+e.number},enumerable:!0,configurable:!0}),t.prototype.onAddedToStage=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.releaseOutside,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},t.prototype.startMove=function(e){this.mouseover=!0,this.refreshStyle()},t.prototype.releaseOutside=function(e){this.mouseover=!1,this.refreshStyle()},t.prototype.onRemovedFromStage=function(){this.touchEnabled=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.releaseOutside,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},t.prototype.initSelectedBorder=function(){var e=RES.getRes("EquipSelectedBorder_json"),t=RES.getRes("EquipSelectedBorder_png"),n=new egret.MovieClipDataFactory(e,t);this.selectedBorder=new egret.MovieClip(n.generateMovieClipData("EquipSelectedBorder"))},t.prototype.showSelectedBorder=function(){if(!this.selectedBorderShowing){this.selectedBorder||this.initSelectedBorder(),this.selectedBorderShowing=!0,e=[-3,-2],this.selectedBorder.x=e[0],this.selectedBorder.y=e[1],this.addChild(this.selectedBorder),this.selectedBorder.gotoAndPlay("EquipSelectedBorder",-1);var e}},t.prototype.hideSelectedBorder=function(){this.selectedBorderShowing&&(this.selectedBorder||this.initSelectedBorder(),this.selectedBorderShowing=!1,this.selectedBorder.stop(),this.removeChild(this.selectedBorder))},Object.defineProperty(t.prototype,"canSelect",{get:function(){return this._canSelect},set:function(e){this._canSelect=e,!e&&this.selected?this.selected=!1:this.refreshStyle(),e||(t=[void 0,void 0],this.callback_unselected=t[0],this.callback_unselected=t[1]);var t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,this.refreshStyle()},enumerable:!0,configurable:!0}),t.prototype.refreshStyle=function(){var e=7;this.canSelect&&(e+=10)&&this.selected&&(e+=10),e!=this.x&&(egret.Tween.removeTweens(this),egret.Tween.get(this).to({x:e},100)),this.img_equip.filters=this.canSelect&&this.mouseover||this.selected?[GlowFilter.mouseover]:[],this.selected?this.showSelectedBorder():this.hideSelectedBorder()},t.prototype.onClick=function(){this.mouseover=!1,this.canSelect&&(this.selected=!this.selected,this.selected?"undefined"!=typeof this.callback_selected&&this.callback_selected():"undefined"!=typeof this.callback_unselected&&this.callback_unselected())},t.prototype.setCallback=function(e){var t=e.unselected,n=e.selected;t||(t=function(){return Game.room.selfPlayer.turnToUseSkill("")}),r=[t,n],this.callback_unselected=r[0],this.callback_selected=r[1],this.canSelect=!0,this.selected=!1;var r},t.prototype.onSelectCallOk=function(){this.setCallback({selected:function(){return Game.room.askingParam.btnStatus.ok.onClick()}})},t}(eui.Component);__reflect(SelfEquip.prototype,"SelfEquip");var SelfGameArea=function(e){function t(){var t=e.call(this)||this;return t.handCardsCollection=new eui.ArrayCollection,t.minSelectCount=0,t.maxSelectCount=0,t.selectedCards=[],t.judgeZoneUI=[],t.addEventListener(egret.Event.COMPLETE,t.onComplete,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"equipUI",{get:function(){return[this.equipUI0,this.equipUI1,this.equipUI2,this.equipUI3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"country",{set:function(e){this.cardCountLabel.country=e,this.generalArea.country=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"identity",{set:function(e){this._identity=e,this.generalArea.identity=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alive",{set:function(e){if(this.generalArea.alive=e,e)this.img_deadFlag.visible=!1;else{var t=Game.getIdentityName(this._identity)+"Dead_png";RES.hasRes(t)||(t=""),this.img_deadFlag.source=t,this.img_deadFlag.visible=!0}},enumerable:!0,configurable:!0}),t.prototype.onComplete=function(e){this.list_handCards.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onChangeHand,this),this.list_handCards.dataProvider=this.handCardsCollection},t.prototype.onChangeHand=function(e){var t=this.list_handCards.dataProvider.getItemAt(e.itemIndex),n=this.list_handCards.selectedItems.includes(t);if(n){this.selectedCards.push(Game.room.getCardByID(t.cardID));var r=this.selectedCount;if(r>this.maxSelectCount){var a=r-this.maxSelectCount;this.cancelSelectCards(a)}}else this.selectedCards=this.selectedCards.filter(function(e){return e.zone!=Zone.Hand||e.cardID!=t.cardID});this.onChange()},t.prototype.onChangeEquip=function(e,t){var n=Game.room.selfPlayer.equipZone[e];if(t){this.selectedCards.push(n);var r=this.selectedCount;if(r>this.maxSelectCount){var a=r-this.maxSelectCount;this.cancelSelectCards(a)}}else this.selectedCards=this.selectedCards.filter(function(e){return e.zone!=Zone.Equip||e.cardID!=n.cardID});this.onChange()},t.prototype.cancelSelectCards=function(e){var t=this,n=this.selectedCards.splice(0,e);this.list_handCards.selectedItems=this.list_handCards.selectedItems.filter(function(e){return n.every(function(t){return t.zone!=Zone.Hand||t.cardID!=e.cardID})}),Game.room.selfPlayer.equipZone.forEach(function(e){e&&n.some(function(t){return t.zone==Zone.Equip&&t.cardID==e.cardID})&&(t.equipUI[e["class"].equipType].selected=!1)})},t.prototype.onChange=function(){UI.self.operationArea.refreshButtonStatus(),UI.sceneGame.clearPlayerSelect(),UI.sceneGame.refreshPlayerSelect(),this.refreshSelectedItem(),UI.sceneGame.refreshTip()},t.prototype.refreshSelectedItem=function(){for(var e=function(e){var n=t.list_handCards.getElementAt(e);n.refreshStyle(t.list_handCards.selectedItems.some(function(e){return e==n.data}))},t=this,n=0;n<this.list_handCards.dataProvider.length;n++)e(n)},Object.defineProperty(t.prototype,"selectedCount",{get:function(){return this.selectedCards.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedCardIDs",{get:function(){return Game.getCardIDs(this.selectedCards)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectCorrectly",{get:function(){if(Game.room){if(this.selectedCount<this.minSelectCount||this.selectedCount>this.maxSelectCount)return!1;var e=UI.self.gameArea.selectedCards,t=Game.room.selectedPlayers;return Game.room.askingParam.selectCorrectly(e,Game.room.selfPlayer,t)}},enumerable:!0,configurable:!0}),t.prototype.cancelSelection=function(){var e=this;this.selectedCards=[];var t=Game.room.selfPlayer.equipZoneCards;t=t.filter(function(e){return Game.room.askingSkillName!="$"+e["class"].name}),t.map(function(e){return e["class"].equipType}).forEach(function(t){e.equipUI[t].selected=!1}),this.list_handCards.selectedItems=[],UI.self.operationArea.refreshButtonStatus(),this.refreshSelectedItem()},t.prototype.getEnabledCards=function(){var e=Game.room.selfPlayer.hand.concat(Game.room.selfPlayer.equipZoneCards),t=this.selectedCards;return e=e.filter(function(e){return!t.includes(e)}),Game.room.askingParam&&(e=0==Game.room.askingParam.maxCardCount(Game.room.selfPlayer)?[]:Game.room.askingParam.filterCard(Game.room.selfPlayer,this.selectedCards,e)),e},t.prototype.refreshCardStatus=function(){for(var e=this.getEnabledCards(),t=this.handCardsCollection,n=0;n<t.length;n++){var r=t.getItemAt(n),a=Game.room.getCardByID(r.cardID),i=void 0;if(Game.room.askingParam){var o=!e.includes(a);i={dark:o,disabled:o}}else i={dark:!1,disabled:!0};r.dark=i.dark,r.disabled=i.disabled,t.replaceItemAt(r,n)}},t.prototype.refreshEquipCanSelect=function(){var e=this,t=this.getEnabledCards(),n=Game.room.selfPlayer.equipZoneCards,r=n.filter(function(e){return Game.room.askingSkillName=="$"+e["class"].name?!0:t.includes(e)?!0:!1});r.map(function(e){return e["class"].equipType}).forEach(function(t){e.equipUI[t].setCallback({unselected:function(){e.onChangeEquip(t,!1)},selected:function(){e.onChangeEquip(t,!0)}})});var a=Game.room.selfPlayer.equipZoneCards.filter(function(e){return!r.includes(e)});a.map(function(e){return e["class"].equipType}).forEach(function(t){e.equipUI[t].canSelect=!1})},t.prototype.clearSelectedHandCards=function(){UI.self.gameArea.list_handCards.selectedItems=[],UI.self.gameArea.refreshSelectedItem()},t.prototype.getCardRenderer=function(e){for(var t=0;t<this.list_handCards.dataProvider.length;t++){var n=this.list_handCards.getElementAt(t);if(n.data.cardID==e)return n}},t.getJudgeZoneCardPicName=function(e){return"Big"+e+"_png"},t.prototype.addToJudgeZoneUI=function(e){var n=new JudgeZoneFlag;n.width=25,n.height=25,n.right=this.width,n.y=0,n.source=t.getJudgeZoneCardPicName(e),this.addChild(n),this.judgeZoneUI.push(n),this.refreshJudgeZoneUI()},t.prototype.removeFromJudgeZoneUI=function(e){for(var n=t.getJudgeZoneCardPicName(e),r=0;r<this.judgeZoneUI.length;r++)this.judgeZoneUI[r].source==n&&(this.removeChild(this.judgeZoneUI[r]),this.judgeZoneUI.splice(r,1),r--);this.refreshJudgeZoneUI()},t.prototype.refreshJudgeZoneUI=function(){var e=(this.judgeZoneUI.length,2);this.judgeZoneUI.every(function(t,n){var r=905+n*(t.width+e);return t.toRight&&t.toRight==r||(t.toRight=r,egret.Tween.removeTweens(t),egret.Tween.get(t).to({right:r},300)),!0})},t}(eui.Component);__reflect(SelfGameArea.prototype,"SelfGameArea");var SelfGeneralArea=function(e){function t(){var t=e.call(this)||this;return t.skillButtons=[],t.once(egret.Event.COMPLETE,t.onComplete,t),t}return __extends(t,e),t.prototype.onComplete=function(){this.img_seatNum.source="",this.lb_generalName.filters=[GlowFilter.generalNameGlow]},Object.defineProperty(t.prototype,"seatNum",{set:function(e){var t="SelfSeat"+e+"_png";this.img_seatNum.source=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alive",{set:function(e){this.parent.filters=e?[]:[ColorFilter.gray]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"country",{set:function(e){this.img_country.source=Game.getCountryName(e).toUpperCase()+"_png",this.img_generalNameBG.source="Self"+Game.getCountryName(e)+"BG"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"general",{set:function(e){this.img_general.source=e.name+"_png"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{set:function(e){this.lb_generalName.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skills",{set:function(e){var t=this,n=!1,r=0,a=Math.ceil(e.length/2);e.every(function(i,o){n=!n,n&&r++;var s=n&&o==e.length-1,l=o>=t.skillButtons.length;return l?t.skillButtons.push(new SkillButton(i)):t.skillButtons[o].skill=i,t.skillButtons[o].width=s?106:52,t.skillButtons[o].height=20,t.skillButtons[o].bottom=21*(a-r),n?t.skillButtons[o].left=0:t.skillButtons[o].right=0,t.skillButtons[o]["long"]=s,l&&t.group_skills.addChild(t.skillButtons[o]),!0});for(var i=e.length;i<this.skillButtons.length;)this.group_skills.removeChild(this.skillButtons[i]),this.skillButtons.splice(i,1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"identity",{set:function(e){this.btn_identity.identity=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentToSelect",{get:function(){return this.group_componentToSelect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"helpMe",{set:function(e){this.img_helpMe.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"back",{set:function(e){this.img_backSideState.visible=e},enumerable:!0,configurable:!0}),t.prototype.refreshSkillButtons=function(){this.skillButtons.forEach(function(e){e.refreshStatus()})},t.prototype.cancelSelectedSkill=function(){this.skillButtons.forEach(function(e){return e.selected=!1})},t.prototype.playEffect=function(e){var t=this;e.x=this.componentToSelect.x+this.componentToSelect.width/2,e.y=this.componentToSelect.y+this.componentToSelect.height/2,this.addChild(e),e.gotoAndPlay(1,1),e.addEventListener(egret.Event.COMPLETE,function(){return t.removeChild(e)},this)},t}(eui.Component);__reflect(SelfGeneralArea.prototype,"SelfGeneralArea");var SelfHPArea=function(e){function t(){var t=e.call(this)||this;return t.HPColor=[[1],[3,1],[3,2,1],[3,2,1,1],[3,2,2,1,1]],t}return __extends(t,e),Object.defineProperty(t.prototype,"maxHP",{get:function(){return this._maxHP},set:function(e){this._maxHP=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HP",{get:function(){return this._HP},set:function(e){this._HP=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HPComponents",{get:function(){if(!this.group_HP)return null;
for(var e=[],t=0;5>t;t++)e.push(this.group_HP.getChildAt(t));return e},enumerable:!0,configurable:!0}),t.prototype.refresh=function(){var e=this,t=this.HPComponents;if(t){var n=this.maxHP>0?this.HPColor[this.maxHP-1]:null,r=n&&this.HP>0?n[this.HP-1]:0,a="";1==r?a="GreenHPBig":2==r?a="OrangeHPBig":3==r&&(a="RedHPBig"),t.every(function(t,n){var r=n+1;if(e.maxHP<r)return t.visible=!1,!0;t.visible=!0;var i=r<=e.HP;return i?t.source=a:t.source="BlackHPBig",t.bottom=3+17*n,!0})}},t.prototype.playLoseHPEffect=function(e,t,n){for(var r=this,a=function(e){var t=n.splice(0,1)[0];t.x=i.width/2,t.y=i.height-3-17*e,i.addChild(t),t.gotoAndPlay(1,1),t.addEventListener(egret.Event.COMPLETE,function(){return r.removeChild(t)},i)},i=this,o=t;e>o;o++)a(o)},t}(eui.Component);__reflect(SelfHPArea.prototype,"SelfHPArea");var SkillButton=function(e){function t(t){var n=e.call(this)||this;return n.selectedBorderShowing=!1,n._selected=!1,n._long=!1,n.selecting=!1,n.once(egret.Event.COMPLETE,function(){n.onComplete(t)},n),n.skinName="SkillButtonSkin",n}return __extends(t,e),t.prototype.onComplete=function(e){this.skill=e,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},Object.defineProperty(t.prototype,"skill",{get:function(){return this._skill},set:function(e){if(this._skill!=e){this._skill=e;var t;switch(e.type){case SkillType.Normal:t="Normal";break;case SkillType.Lock:t="Lock";break;case SkillType.Limit:t="Limit";break;case SkillType.Awake:t="Awake";break;default:throw new Error("unknown skillType")}this.img_up.source="SkillButton_"+t+"_Up_png",this.img_down.source="SkillButton_"+t+"_Down_png",this.img_disabled.source="SkillButton_"+t+"_Disabled_png",this.label=e.tipName||"",this.refreshFilter(),this.refreshStatus()}},enumerable:!0,configurable:!0}),t.prototype.$setEnabled=function(t){var n=e.prototype.$setEnabled.call(this,t);return this.refreshFilter(),n},t.prototype.refreshFilter=function(){var e;if(this.enabled)switch(this.skill.type){case SkillType.Normal:e=GlowFilter.normalSkillFilter;break;case SkillType.Lock:e=GlowFilter.lockSkillFilter;break;case SkillType.Limit:e=GlowFilter.limitSkillFilter;break;case SkillType.Awake:e=GlowFilter.awakeSkillFilter;break;default:throw new Error("unknown skillType")}else e=GlowFilter.disabledSkillFilter;this.labelDisplay.filters=[e]},t.prototype.refreshStatus=function(){this.enabled=this.skill.enabled(Game.room.selfPlayer)||this.selected||this.selecting,Game.room.askingMatch(AskingType.UseSkill,this.skill.name)&&(this.skill.filterCard!=Package.skillFilterCardDefault||this.skill.filterSelect)&&(this.selected=!0)},t.prototype.onClick=function(){var e=Game.room.selfPlayer,t=!1;this.skill.filterSelect?t=!0:this.skill.viewAs&&e.room.askPlayers.includes(e)&&e.room.askingType==AskingType.PlayCard&&(t=!0),this.skill.filterCard!=Package.skillFilterCardDefault||t?Game.room.askingType==AskingType.UseSkill&&Game.room.askingMatch(AskingType.UseSkill,this.skill.name)?Game.room.askingParam.btnStatus.cancel.onClick():this.selected?Game.room.selfPlayer.turnToUseSkill():(this.selecting=!0,Game.room.selfPlayer.turnToUseSkill(this.skill.name),this.selecting=!1,this.selected=!0):this.selected?Game.room.askingParam.btnStatus.cancel.onClick():Game.room.selfPlayer.answer({skill:this.skill.name})},t.prototype.initSelectedBorder=function(){var e=RES.getRes("SkillSelectedBorder_json"),t=RES.getRes("SkillSelectedBorder_png"),n=new egret.MovieClipDataFactory(e,t);this.selectedBorder=new egret.MovieClip(n.generateMovieClipData("SkillSelectedBorder"))},t.prototype.showSelectedBorder=function(){if(!this.selectedBorderShowing){this.selectedBorder||this.initSelectedBorder(),this.selectedBorderShowing=!0,e=[-4,-3],this.selectedBorder.x=e[0],this.selectedBorder.y=e[1],this.addChild(this.selectedBorder),this.selectedBorder.gotoAndPlay("SkillSelectedBorder",-1);var e}},t.prototype.hideSelectedBorder=function(){this.selectedBorderShowing&&(this.selectedBorder||this.initSelectedBorder(),this.selectedBorderShowing=!1,this.selectedBorder.stop(),this.removeChild(this.selectedBorder))},t.prototype.refreshStyle=function(){this.selected?this.showSelectedBorder():this.hideSelectedBorder(),this.selectedBorder&&(this.selectedBorder.scaleX=this["long"]?1.9:1)},Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,this.refreshStyle()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"long",{get:function(){return this._long},set:function(e){this._long=e,this.refreshStyle()},enumerable:!0,configurable:!0}),t}(eui.Button);__reflect(SkillButton.prototype,"SkillButton");var TargetLine=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this.img_line=new eui.Image,this.img_line.source="TargetLine_png",this.img_line.left=0,this.img_line.right=0,this.addChild(this.img_line)},t.show=function(e,n){var r=new t,a={x:e.x+e.width/2,y:e.y+e.height/2},i={x:n.x+n.width/2,y:n.y+n.height/2};r.x=a.x,r.y=a.y;var o=i.x-a.x,s=i.y-a.y,l=Math.atan2(s,o),u=180*l/Math.PI;r.rotation=u,r.width=0;var c=Math.sqrt(Math.pow(o,2)+Math.pow(s,2));UI.sceneGame.addChild(r);var d=egret.Tween.get(r);d.to({width:c},300),d.wait(600),d.to(__assign({alpha:0,width:0},i),300),d.call(function(){UI.sceneGame.removeChild(r)}),t.tw=d},t}(eui.Group);__reflect(TargetLine.prototype,"TargetLine");var UI=function(){function e(){}return Object.defineProperty(e,"sceneGame",{get:function(){return SceneGame.instance},enumerable:!0,configurable:!0}),Object.defineProperty(e,"self",{get:function(){return e._self||(e._self={gameArea:e.sceneGame.selfGameArea,generalArea:e.sceneGame.selfGameArea.generalArea,operationArea:e.sceneGame.operationArea}),e._self},enumerable:!0,configurable:!0}),Object.defineProperty(e,"others",{get:function(){return e._others||(e._others={gameArea:e.sceneGame.othersGameArea,generalArea:function(t){return e.sceneGame.othersGameArea.generalAreas[t]}}),e._others},enumerable:!0,configurable:!0}),e.generalArea=function(t){return t==Game.room.selfPlayer.seatID?e.self.generalArea:e.others.generalArea(e.getGeneralAreaIndex(t))},e.bigArea=function(t){return t==Game.room.selfPlayer.seatID?e.self.gameArea:e.others.generalArea(e.getGeneralAreaIndex(t))},e.getGeneralAreaIndex=function(e){var t;return t=e>Game.room.selfPlayer.seatID?e-Game.room.selfPlayer.seatID-1:Game.room.playerCount-(Game.room.selfPlayer.seatID-e)-1},e}();__reflect(UI.prototype,"UI");var ColorFilter=function(){function e(){}return e.gray=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),e}();__reflect(ColorFilter.prototype,"ColorFilter");var GlowFilter=function(){function e(){}return e.mouseover=new egret.GlowFilter(16777215,1,6,6,1,2,!1,!1),e.tipBorderGlow=new egret.GlowFilter(471630,1,2,2,16,2,!1,!1),e.generalNameGlow=new egret.GlowFilter(0,1,2,2,7,1,!1,!1),e.normalSkillFilter=new egret.GlowFilter(1213468,1,2,2,10,1,!1,!1),e.lockSkillFilter=new egret.GlowFilter(8802832,1,2,2,10,1,!1,!1),e.limitSkillFilter=new egret.GlowFilter(14881034,1,2,2,10,1,!1,!1),e.awakeSkillFilter=new egret.GlowFilter(1081144,1,2,2,10,1,!1,!1),e.disabledSkillFilter=new egret.GlowFilter(5197647,1,2,2,10,1,!1,!1),e}();__reflect(GlowFilter.prototype,"GlowFilter");var Util=function(){function e(){}return e.timeout=function(e){return new Promise(function(t){setTimeout(t,e)})},e.random=function(e,t){return e>t&&(n=[t,e],e=n[0],t=n[1]),Math.floor(Math.random()*(t-e+1)+e);var n},e}();__reflect(Util.prototype,"Util");